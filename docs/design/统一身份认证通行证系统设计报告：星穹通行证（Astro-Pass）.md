# 统一身份认证通行证系统设计报告：星穹通行证（Astro-Pass）

**作者：** Manus AI
**日期：** 2025年11月24日
**项目目标：** 设计一个统一的、功能完善的身份认证通行证系统，采用二次元学院治愈系风格，并兼容 OAuth 2.0 和 OIDC 等现有方案。

---

## 摘要

"星穹通行证"（Astro-Pass）是一个面向未来、功能全面的身份管理与访问控制（IAM）解决方案。它不仅在技术上完全兼容 **OAuth 2.0** 和 **OpenID Connect (OIDC)** 协议，支持 **多因素认证 (MFA)**、**细粒度权限管理 (ABAC)** 和全面的**审计日志**，更在用户体验上融入了独特的**二次元学院治愈系**风格，旨在为用户提供一个安全、亲切、舒适的认证体验。

---

## 第一部分：需求分析与技术选型

### 1.1 核心功能需求

| 功能模块 | 需求描述 | 技术要求/协议 |
| :--- | :--- | :--- |
| **基础认证** | 登录、注册、密码找回、用户管理 | 密码哈希（Argon2/Bcrypt）、安全传输（HTTPS/TLS） |
| **互操作性** | 单点登录（SSO）、授权和身份验证 | **OAuth 2.0**（授权框架）、**OpenID Connect (OIDC)**（身份层） |
| **安全性增强** | 多因素认证（MFA） | TOTP、WebAuthn（FIDO2）、短信/邮件验证 |
| **集成性** | 社交媒体登录 | OAuth 2.0 流程集成（如微信、GitHub） |
| **权限管理** | 细粒度的权限控制 | **RBAC**（基于角色的访问控制）+ **ABAC**（基于属性的访问控制） |
| **可审计性** | 完整的操作和安全事件记录 | 审计日志（不可篡改、高可用） |
| **用户体验** | 用户自助管理账户信息、MFA设置等 | 自助服务门户（Self-Service Portal） |

### 1.2 技术栈选型

系统核心服务推荐使用 **Golang** 开发，以其高性能和高并发特性，确保认证服务的稳定性和响应速度。

| 领域 | 建议技术/组件 | 选型理由 |
| :--- | :--- | :--- |
| **核心服务** | **Golang** | 高并发、高性能、适合构建高可用的认证服务。 |
| **数据库** | **mysql** | 稳定、可靠、支持复杂查询和事务，适合存储身份和权限数据。 |
| **缓存** | **Redis** | 用于存储 Session、Token 吊销列表、MFA 临时状态等，提高认证速度。 |
| **权限模型** | **Casbin**（或类似库） | 灵活支持 RBAC、ABAC 等多种权限模型，易于集成。 |

---

## 第二部分：系统架构与功能模块设计

### 2.1 整体系统架构

系统采用模块化设计，核心是 **认证核心服务 (Auth Core Service)**，负责所有身份验证和授权逻辑。

**核心组件：**

1.  **API 网关：** 统一入口，负责安全和流量控制。
2.  **认证核心服务：** 包含用户管理、认证、授权（OAuth/OIDC）、权限管理和客户端管理五大模块。
3.  **数据层：** Pmysql (持久化存储) + Redis (高速缓存)。
4.  **独立服务：** 审计日志服务（确保日志不可篡改）、通知服务（邮件/短信）。

### 2.2 授权与身份协议兼容性

"星穹通行证"作为 **OIDC 身份提供者 (IdP)** 和 **OAuth 2.0 授权服务器 (AS)**，提供以下标准端点：

| 协议端点 | 作用 | 协议标准 |
| :--- | :--- | :--- |
| `/oauth2/authorize` | 授权端点：用户登录并同意授权（Consent Screen）。 | OAuth 2.0 / OIDC |
| `/oauth2/token` | Token 端点：应用使用授权码换取 Access Token、Refresh Token 和 ID Token。 | OAuth 2.0 / OIDC |
| `/oauth2/userinfo` | 用户信息端点：应用使用 Access Token 获取用户的标准身份信息。 | OIDC |
| `/oauth2/jwks` | JWKS 端点：应用获取公钥，用于验证 Token 签名。 | OIDC |
| `/.well-known/openid-configuration` | 发现端点：OIDC 客户端自动发现所有配置信息。 | OIDC Discovery |

### 2.3 细粒度权限管理 (RBAC/ABAC)

系统采用 **RBAC + ABAC 混合模型**，实现灵活且强大的权限控制。

*   **RBAC：** 定义基础角色（如学生、教师、管理员）。
*   **ABAC：** 通过属性（用户属性、资源属性、环境属性）定义动态权限策略。
    *   **示例策略：** `(Role == '教师') AND (Time >= 9:00) AND (Resource.Owner == User.ID)` -> **允许**。

**权限决策流程：** 资源服务器将请求信息发送给认证核心服务，由权限管理模块根据 ABAC 策略引擎进行实时决策，返回 Permit/Deny。

### 2.4 安全与审计

*   **密码存储：** 采用 **Argon2** 算法进行哈希存储。
*   **Token 安全：** Access Token 采用 **JWT (RS256 签名)**，设置短有效期（5-15分钟）。Refresh Token 采用长有效期，存储在数据库中。
*   **审计日志：** 所有认证、授权和管理事件均记录到独立的审计日志服务，确保日志的完整性和不可篡改性。

---

## 第三部分：二次元学院治愈系风格设计概念（UI/UX）

### 3.1 视觉风格指南

**设计理念：** 治愈、安全、亲切。

| 元素 | 概念描述 | 风格关键词 |
| :--- | :--- | :--- |
| **核心配色** | **马卡龙治愈色系**：主色"星穹蓝"(`#AEC6E4`)，辅色"薄荷绿"(`#B5EAD7`)，背景"云朵白"(`#F7F7F7`)。 | 柔和、低饱和度、清新 |
| **组件设计** | **大圆角、轻微投影、毛玻璃效果**。所有交互元素圆润化，营造轻盈感。 | 圆润、轻盈、透明 |
| **字体** | 选用圆润、可爱的无衬线字体（如思源柔黑体），增加亲切感。 | 亲切、易读 |
| **吉祥物** | **Q版学院角色"星宝"**，作为引导员出现在登录、MFA 设置等关键流程，提供人性化的提示。 | 可爱、引导、陪伴 |

### 3.2 关键界面设计概念

#### 3.2.1 登录/注册界面

*   **背景：** 低饱和度的学院场景插画（如星空、图书馆）。
*   **登录框：** 居中卡片，使用白色背景和毛玻璃效果，突出主体。
*   **交互：** 吉祥物"星宝"在输入框旁，提供治愈系提示语，如："欢迎回来，请输入通行证信息哦~"。

#### 3.2.2 自助服务门户

*   **布局：** 卡片式布局，功能模块清晰。
*   **MFA 设置：** 命名为"安全守护契约"，使用薄荷绿辅色强调安全。MFA 绑定流程设计为"安全升级任务"，通过步骤化引导和柔和动画（如星星汇聚）优化用户体验。

### 3.3 风格化文案示例

将系统提示信息进行风格化，以符合治愈系学院的氛围。

| 场景 | 治愈系学院文案 |
| :--- | :--- |
| **登录失败** | 通行证信息似乎有些偏差呢，请再仔细确认一下哦。 |
| **MFA 验证码错误** | 魔法口令（MFA Code）输入错误，请检查您的守护装置（Authenticator App）。 |
| **注册成功** | 恭喜您！成功获得星穹通行证，欢迎加入学院！ |
| **会话过期** | 休息时间到啦，为了您的安全，请重新验证通行证信息。 |

---

## 结论

"星穹通行证"（Astro-Pass）的设计方案在技术上实现了对 **OAuth 2.0** 和 **OIDC** 的全面兼容，集成了 **MFA**、**ABAC** 等高级安全和权限功能，确保了系统的功能完善性和安全性。同时，通过独特的**二次元学院治愈系**视觉和交互设计，极大地提升了用户体验，使其成为一个既强大又亲切的统一身份认证系统。

---


