# æ˜Ÿç©¹é€šè¡Œè¯ï¼ˆAstro-Passï¼‰ç»Ÿä¸€èº«ä»½è®¤è¯SSOç³»ç»Ÿ - å®Œæ•´è®¾è®¡æ–‡æ¡£

**é¡¹ç›®ç‰ˆæœ¬ï¼š** v2.0  
**æ–‡æ¡£æ—¥æœŸï¼š** 2025å¹´11æœˆ28æ—¥  
**é¡¹ç›®ç±»å‹ï¼š** ç»Ÿä¸€èº«ä»½è®¤è¯ä¸å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç³»ç»Ÿ  
**æŠ€æœ¯æ ˆï¼š** Go + Gin + MySQL + React + TypeScript

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#2-ç³»ç»Ÿæ¶æ„è®¾è®¡)
3. [æŠ€æœ¯æ ˆè¯¦è§£](#3-æŠ€æœ¯æ ˆè¯¦è§£)
4. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#4-æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
5. [æ•°æ®æ¨¡å‹è®¾è®¡](#5-æ•°æ®æ¨¡å‹è®¾è®¡)
6. [APIæ¥å£è®¾è®¡](#6-apiæ¥å£è®¾è®¡)
7. [å®‰å…¨æ¶æ„è®¾è®¡](#7-å®‰å…¨æ¶æ„è®¾è®¡)
8. [æƒé™ç®¡ç†ç³»ç»Ÿ](#8-æƒé™ç®¡ç†ç³»ç»Ÿ)
9. [å‰ç«¯æ¶æ„è®¾è®¡](#9-å‰ç«¯æ¶æ„è®¾è®¡)
10. [éƒ¨ç½²ä¸è¿ç»´](#10-éƒ¨ç½²ä¸è¿ç»´)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

æ˜Ÿç©¹é€šè¡Œè¯ï¼ˆAstro-Passï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„**ç»Ÿä¸€èº«ä»½è®¤è¯ä¸å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç³»ç»Ÿ**ï¼Œå®Œå…¨å…¼å®¹ **OAuth 2.0** å’Œ **OpenID Connect (OIDC)** æ ‡å‡†åè®®ã€‚

**æ ¸å¿ƒå®šä½ï¼š**
- ä¼ä¸šçº§èº«ä»½è®¤è¯ä¸­å¿ƒï¼ˆIdentity Providerï¼‰
- OAuth 2.0 æˆæƒæœåŠ¡å™¨ï¼ˆAuthorization Serverï¼‰
- OIDC èº«ä»½æä¾›å•†ï¼ˆOpenID Providerï¼‰
- ç»Ÿä¸€ç”¨æˆ·ç®¡ç†å¹³å°

### 1.2 æ ¸å¿ƒç‰¹æ€§æ€»è§ˆ

#### ğŸ” è®¤è¯èƒ½åŠ›
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•ï¼ˆç”¨æˆ·åã€é‚®ç®±ï¼‰
- âœ… JWTä»¤ç‰Œè®¤è¯ï¼ˆAccess Token + Refresh Tokenï¼‰
- âœ… å¤šå› ç´ è®¤è¯ï¼ˆTOTPã€WebAuthnï¼‰
- âœ… æ— å¯†ç è®¤è¯ï¼ˆç”Ÿç‰©è¯†åˆ«ã€å®‰å…¨å¯†é’¥ï¼‰
- âœ… ç¤¾äº¤ç™»å½•ï¼ˆGitHub OAuthï¼‰
- âœ… å¯†ç é‡ç½®ä¸é‚®ç®±éªŒè¯

#### ğŸŒ SSOå•ç‚¹ç™»å½•èƒ½åŠ›
- âœ… OAuth 2.0 æˆæƒç æµç¨‹
- âœ… OpenID Connect å®Œæ•´å®ç°
- âœ… ç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥ç®¡ç†
- âœ… æˆæƒåŒæ„é¡µé¢
- âœ… JWKSå…¬é’¥ç«¯ç‚¹
- âœ… OIDCè‡ªåŠ¨å‘ç°
- âœ… ä»¤ç‰Œåˆ·æ–°ä¸æ’¤é”€

#### ğŸ›¡ï¸ å®‰å…¨èƒ½åŠ›
- âœ… è´¦æˆ·é”å®šï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
- âœ… ä¼šè¯ç®¡ç†ï¼ˆå¤šè®¾å¤‡è¿½è¸ªï¼‰
- âœ… å®¡è®¡æ—¥å¿—ï¼ˆå®Œæ•´è®°å½•ï¼‰
- âœ… å¯†ç ç­–ç•¥ï¼ˆå¤æ‚åº¦+å†å²ï¼‰
- âœ… é€Ÿç‡é™åˆ¶ï¼ˆAPIé˜²æŠ¤ï¼‰
- âœ… å®‰å…¨å“åº”å¤´ï¼ˆXSS/ç‚¹å‡»åŠ«æŒé˜²æŠ¤ï¼‰

#### ğŸ‘¥ æƒé™èƒ½åŠ›
- âœ… RBACï¼ˆåŸºäºè§’è‰²ï¼‰
- âœ… ABACï¼ˆåŸºäºå±æ€§ï¼‰
- âœ… Casbinç­–ç•¥å¼•æ“
- âœ… ç»†ç²’åº¦æƒé™æ§åˆ¶

#### ğŸ“Š ç®¡ç†èƒ½åŠ›
- âœ… ç”¨æˆ·ç®¡ç†ï¼ˆCRUDï¼‰
- âœ… è§’è‰²æƒé™ç®¡ç†
- âœ… OAuth2å®¢æˆ·ç«¯ç®¡ç†
- âœ… å®¡è®¡æ—¥å¿—æŸ¥è¯¢
- âœ… é€šçŸ¥ä¸­å¿ƒ
- âœ… ç³»ç»Ÿç›‘æ§

### 1.3 åº”ç”¨åœºæ™¯

| åœºæ™¯ | è¯´æ˜ | ä»·å€¼ |
|------|------|------|
| **ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ** | ç»Ÿä¸€å‘˜å·¥èº«ä»½ï¼Œä¸€æ¬¡ç™»å½•è®¿é—®æ‰€æœ‰ç³»ç»Ÿ | æå‡æ•ˆç‡ï¼Œé™ä½ç®¡ç†æˆæœ¬ |
| **SaaSå¹³å°** | å¤šç§Ÿæˆ·èº«ä»½ç®¡ç†ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥ | å¿«é€Ÿé›†æˆï¼Œå®‰å…¨å¯é  |
| **å¼€æ”¾å¹³å°** | OAuth 2.0æä¾›å•†ï¼Œå¼€å‘è€…ç”Ÿæ€ | æ‰©å±•ç”Ÿæ€ï¼Œå¢åŠ ç²˜æ€§ |
| **æ•™è‚²æœºæ„** | å­¦ç”Ÿæ•™å¸ˆç»Ÿä¸€è®¤è¯ï¼Œè·¨ç³»ç»Ÿè®¿é—® | ç®€åŒ–ç®¡ç†ï¼Œæ•°æ®äº’é€š |
| **æ”¿åºœæœºæ„** | å…¬æ°‘èº«ä»½è®¤è¯ï¼Œå®‰å…¨åˆè§„ | ç¬¦åˆæ ‡å‡†ï¼Œå¯å®¡è®¡ |

---

## 2. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å®¢æˆ·ç«¯å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Webå‰ç«¯  â”‚  â”‚ ç§»åŠ¨åº”ç”¨ â”‚  â”‚ç¬¬ä¸‰æ–¹åº”ç”¨â”‚  â”‚ ç®¡ç†åå° â”‚       â”‚
â”‚  â”‚ React    â”‚  â”‚ iOS/å®‰å“ â”‚  â”‚ OAuth2   â”‚  â”‚ Admin    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTPS/TLS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      APIç½‘å…³/è´Ÿè½½å‡è¡¡å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Nginx / Traefik / Kong                                   â”‚ â”‚
â”‚  â”‚  - SSLç»ˆæ­¢  - è´Ÿè½½å‡è¡¡  - é€Ÿç‡é™åˆ¶  - è¯·æ±‚è·¯ç”±           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨æœåŠ¡å±‚ï¼ˆGolang + Ginï¼‰                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ä¸­é—´ä»¶å±‚                                                 â”‚  â”‚
â”‚  â”‚  [è®¤è¯] [æƒé™] [æ—¥å¿—] [é™æµ] [æ¢å¤] [å®‰å…¨å¤´] [æŒ‡æ ‡]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ è®¤è¯æœåŠ¡     â”‚  â”‚ ç”¨æˆ·æœåŠ¡     â”‚  â”‚ OAuth2æœåŠ¡   â”‚         â”‚
â”‚  â”‚ AuthService  â”‚  â”‚ UserService  â”‚  â”‚ OAuth2Svc    â”‚         â”‚
â”‚  â”‚ - æ³¨å†Œç™»å½•   â”‚  â”‚ - ç”¨æˆ·ç®¡ç†   â”‚  â”‚ - æˆæƒç æµç¨‹ â”‚         â”‚
â”‚  â”‚ - ä»¤ç‰Œåˆ·æ–°   â”‚  â”‚ - èµ„æ–™ä¿®æ”¹   â”‚  â”‚ - ä»¤ç‰Œé¢å‘   â”‚         â”‚
â”‚  â”‚ - å¯†ç é‡ç½®   â”‚  â”‚ - å¯†ç ä¿®æ”¹   â”‚  â”‚ - å®¢æˆ·ç«¯ç®¡ç† â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ æƒé™æœåŠ¡     â”‚  â”‚ å®¡è®¡æœåŠ¡     â”‚  â”‚ ä¼šè¯æœåŠ¡     â”‚         â”‚
â”‚  â”‚ Permission   â”‚  â”‚ AuditService â”‚  â”‚ SessionSvc   â”‚         â”‚
â”‚  â”‚ - RBAC       â”‚  â”‚ - æ—¥å¿—è®°å½•   â”‚  â”‚ - ä¼šè¯è¿½è¸ª   â”‚         â”‚
â”‚  â”‚ - ABAC       â”‚  â”‚ - æ—¥å¿—æŸ¥è¯¢   â”‚  â”‚ - ä¼šè¯æ’¤é”€   â”‚         â”‚
â”‚  â”‚ - Casbin     â”‚  â”‚ - åˆ†æç»Ÿè®¡   â”‚  â”‚ - è®¾å¤‡è¯†åˆ«   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ MFAæœåŠ¡      â”‚  â”‚ é€šçŸ¥æœåŠ¡     â”‚  â”‚ é‚®ä»¶æœåŠ¡     â”‚         â”‚
â”‚  â”‚ MFAService   â”‚  â”‚ Notification â”‚  â”‚ EmailService â”‚         â”‚
â”‚  â”‚ - TOTP       â”‚  â”‚ - å®‰å…¨é€šçŸ¥   â”‚  â”‚ - å¯†ç é‡ç½®   â”‚         â”‚
â”‚  â”‚ - WebAuthn   â”‚  â”‚ - æ´»åŠ¨é€šçŸ¥   â”‚  â”‚ - æ¬¢è¿é‚®ä»¶   â”‚         â”‚
â”‚  â”‚ - æ¢å¤ç      â”‚  â”‚ - ç³»ç»Ÿé€šçŸ¥   â”‚  â”‚ - é‚®ç®±éªŒè¯   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ç¤¾äº¤ç™»å½•æœåŠ¡ â”‚  â”‚ WebAuthnæœåŠ¡ â”‚  â”‚ å¯†ç ç­–ç•¥æœåŠ¡ â”‚         â”‚
â”‚  â”‚ SocialAuth   â”‚  â”‚ WebAuthnSvc  â”‚  â”‚ PasswordPol  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®æŒä¹…å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   MySQL 8.0+         â”‚        â”‚   Redis 7.0+         â”‚      â”‚
â”‚  â”‚ - ç”¨æˆ·æ•°æ®           â”‚        â”‚ - ä¼šè¯ç¼“å­˜           â”‚      â”‚
â”‚  â”‚ - è§’è‰²æƒé™           â”‚        â”‚ - Tokené»‘åå•        â”‚      â”‚
â”‚  â”‚ - OAuth2å®¢æˆ·ç«¯       â”‚        â”‚ - é™æµè®¡æ•°           â”‚      â”‚
â”‚  â”‚ - å®¡è®¡æ—¥å¿—           â”‚        â”‚ - ä¸´æ—¶æ•°æ®           â”‚      â”‚
â”‚  â”‚ - ä¼šè¯è®°å½•           â”‚        â”‚ - MFAä¸´æ—¶çŠ¶æ€        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡é›†æˆ                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SMTPæœåŠ¡ â”‚ â”‚ GitHub   â”‚ â”‚Prometheusâ”‚ â”‚ æ—¥å¿—ç³»ç»Ÿ â”‚          â”‚
â”‚  â”‚ é‚®ä»¶å‘é€ â”‚ â”‚ OAuth    â”‚ â”‚ ç›‘æ§æŒ‡æ ‡ â”‚ â”‚ ELK/Loki â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æœåŠ¡æ¨¡å—åˆ’åˆ†

#### 2.2.1 æ ¸å¿ƒä¸šåŠ¡æœåŠ¡

| æœåŠ¡åç§° | æ–‡ä»¶ä½ç½® | æ ¸å¿ƒèŒè´£ | å…³é”®æ–¹æ³• |
|---------|---------|---------|---------|
| **è®¤è¯æœåŠ¡** | `services/auth_service.go` | ç”¨æˆ·èº«ä»½éªŒè¯ | Register, Login, RefreshToken |
| **ç”¨æˆ·æœåŠ¡** | `services/user_service.go` | ç”¨æˆ·ä¿¡æ¯ç®¡ç† | UpdateProfile, ChangePassword |
| **OAuth2æœåŠ¡** | `services/oauth2_service.go` | OAuth2/OIDCå®ç° | GenerateAuthCode, ExchangeToken, GetUserInfo |
| **æƒé™æœåŠ¡** | `services/permission_service.go` | æƒé™æ§åˆ¶ | CheckPermission, AssignRole |
| **å®¡è®¡æœåŠ¡** | `services/audit_service.go` | æ“ä½œå®¡è®¡ | CreateAuditLog, QueryLogs |
| **MFAæœåŠ¡** | `services/mfa_service.go` | å¤šå› ç´ è®¤è¯ | GenerateTOTP, VerifyTOTP, EnableMFA |
| **ä¼šè¯æœåŠ¡** | `services/session_service.go` | ä¼šè¯ç®¡ç† | CreateSession, GetSessions, RevokeSession |
| **é€šçŸ¥æœåŠ¡** | `services/notification_service.go` | æ¶ˆæ¯é€šçŸ¥ | NotifySecurityEvent, NotifyActivity |
| **é‚®ä»¶æœåŠ¡** | `services/email_service.go` | é‚®ä»¶å‘é€ | SendPasswordReset, SendWelcome |
| **WebAuthnæœåŠ¡** | `services/webauthn_service.go` | æ— å¯†ç è®¤è¯ | BeginRegistration, FinishLogin |
| **ç¤¾äº¤ç™»å½•æœåŠ¡** | `services/social_auth_service.go` | ç¬¬ä¸‰æ–¹ç™»å½• | GetGitHubAuthURL, HandleCallback |
| **å¯†ç ç­–ç•¥æœåŠ¡** | `services/password_policy_service.go` | å¯†ç ç®¡ç† | ValidatePassword, CheckHistory |
| **è´¦æˆ·é”å®šæœåŠ¡** | `services/account_lock_service.go` | é˜²æš´åŠ›ç ´è§£ | IsAccountLocked, RecordAttempt |
| **ABACæœåŠ¡** | `services/abac_service.go` | å±æ€§è®¿é—®æ§åˆ¶ | CheckPermissionWithAttributes |

#### 2.2.2 æ§åˆ¶å™¨å±‚

| æ§åˆ¶å™¨ | æ–‡ä»¶ä½ç½® | å¤„ç†çš„è·¯ç”± |
|--------|---------|-----------|
| **è®¤è¯æ§åˆ¶å™¨** | `controllers/auth_controller.go` | `/api/auth/*` |
| **ç”¨æˆ·æ§åˆ¶å™¨** | `controllers/user_controller.go` | `/api/user/*`, `/api/admin/users/*` |
| **OAuth2æ§åˆ¶å™¨** | `controllers/oauth2_controller.go` | `/api/oauth2/*` |
| **æƒé™æ§åˆ¶å™¨** | `controllers/permission_controller.go` | `/api/permission/*`, `/api/admin/roles/*` |
| **å®¡è®¡æ§åˆ¶å™¨** | `controllers/audit_controller.go` | `/api/audit/*` |
| **MFAæ§åˆ¶å™¨** | `controllers/mfa_controller.go` | `/api/mfa/*` |
| **ä¼šè¯æ§åˆ¶å™¨** | `controllers/session_controller.go` | `/api/session/*` |
| **é€šçŸ¥æ§åˆ¶å™¨** | `controllers/notification_controller.go` | `/api/notifications/*` |
| **WebAuthnæ§åˆ¶å™¨** | `controllers/webauthn_controller.go` | `/api/webauthn/*` |
| **ç¤¾äº¤ç™»å½•æ§åˆ¶å™¨** | `controllers/social_auth_controller.go` | `/api/auth/social/*` |
| **å¥åº·æ£€æŸ¥æ§åˆ¶å™¨** | `controllers/health_controller.go` | `/health`, `/ready` |

#### 2.2.3 ä¸­é—´ä»¶å±‚

| ä¸­é—´ä»¶ | æ–‡ä»¶ä½ç½® | åŠŸèƒ½ |
|--------|---------|------|
| **è®¤è¯ä¸­é—´ä»¶** | `middleware/auth.go` | JWTä»¤ç‰ŒéªŒè¯ |
| **æƒé™ä¸­é—´ä»¶** | `middleware/permission.go` | æƒé™æ£€æŸ¥ |
| **æ—¥å¿—ä¸­é—´ä»¶** | `middleware/logger.go` | è¯·æ±‚æ—¥å¿—è®°å½• |
| **é™æµä¸­é—´ä»¶** | `middleware/ratelimit.go` | APIé€Ÿç‡é™åˆ¶ |
| **æ¢å¤ä¸­é—´ä»¶** | `middleware/recovery.go` | Panicæ¢å¤ |
| **å®‰å…¨å¤´ä¸­é—´ä»¶** | `middleware/security_headers.go` | å®‰å…¨å“åº”å¤´ |
| **æŒ‡æ ‡ä¸­é—´ä»¶** | `middleware/metrics.go` | PrometheusæŒ‡æ ‡ |

### 2.3 æ•°æ®æµè®¾è®¡

#### 2.3.1 ç”¨æˆ·ç™»å½•æµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ å‰ç«¯éªŒè¯ â†’ APIè¯·æ±‚
                        â†“
                  [é™æµä¸­é—´ä»¶]
                        â†“
                  [æ—¥å¿—ä¸­é—´ä»¶]
                        â†“
                  è®¤è¯æ§åˆ¶å™¨
                        â†“
                  è®¤è¯æœåŠ¡
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“                       â†“
      æ£€æŸ¥è´¦æˆ·é”å®š              æŸ¥è¯¢ç”¨æˆ·
            â†“                       â†“
      éªŒè¯å¯†ç                   æ£€æŸ¥çŠ¶æ€
            â†“                       â†“
      ç”ŸæˆJWT Token           åˆ›å»ºä¼šè¯
            â†“                       â†“
      è®°å½•å®¡è®¡æ—¥å¿—            æ¸…é™¤å¤±è´¥è®°å½•
            â†“                       â†“
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
                  è¿”å›Token
                        â†“
                  å‰ç«¯å­˜å‚¨
                        â†“
                  åç»­è¯·æ±‚æºå¸¦Token
```

#### 2.3.2 OAuth2æˆæƒç æµç¨‹

```
ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ é‡å®šå‘åˆ°æˆæƒç«¯ç‚¹
                â†“
          ç”¨æˆ·ç™»å½•éªŒè¯
                â†“
          æ˜¾ç¤ºæˆæƒåŒæ„é¡µé¢
                â†“
          ç”¨æˆ·åŒæ„æˆæƒ
                â†“
          ç”Ÿæˆæˆæƒç 
                â†“
          é‡å®šå‘å›ç¬¬ä¸‰æ–¹åº”ç”¨
                â†“
ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ ä½¿ç”¨æˆæƒç è¯·æ±‚ä»¤ç‰Œç«¯ç‚¹
                â†“
          éªŒè¯æˆæƒç 
                â†“
          éªŒè¯å®¢æˆ·ç«¯å‡­è¯
                â†“
          ç”ŸæˆAccess Token
                â†“
          ç”ŸæˆRefresh Token
                â†“
          è¿”å›ä»¤ç‰Œ
                â†“
ç¬¬ä¸‰æ–¹åº”ç”¨ â†’ ä½¿ç”¨Access Tokenè®¿é—®ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
                â†“
          éªŒè¯Token
                â†“
          è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆOIDCæ ‡å‡†æ ¼å¼ï¼‰
```

#### 2.3.3 WebAuthnæ— å¯†ç ç™»å½•æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»æ— å¯†ç ç™»å½• â†’ å‰ç«¯è¯·æ±‚å¼€å§‹ç™»å½•
                        â†“
                  åç«¯ç”ŸæˆChallenge
                        â†“
                  è¿”å›Challengeç»™å‰ç«¯
                        â†“
                  å‰ç«¯è°ƒç”¨WebAuthn API
                        â†“
                  æµè§ˆå™¨/è®¾å¤‡éªŒè¯ï¼ˆæŒ‡çº¹/Face IDï¼‰
                        â†“
                  è¿”å›ç­¾åå‡­è¯
                        â†“
                  å‰ç«¯æäº¤å‡­è¯åˆ°åç«¯
                        â†“
                  åç«¯éªŒè¯ç­¾å
                        â†“
                  éªŒè¯æˆåŠŸç”ŸæˆJWT Token
                        â†“
                  è¿”å›Tokenå®Œæˆç™»å½•
```

---

## 3. æŠ€æœ¯æ ˆè¯¦è§£

### 3.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯/æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|----------|------|------|---------|
| **Go** | 1.24+ | æ ¸å¿ƒè¯­è¨€ | é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€å†…å­˜å®‰å…¨ã€ç¼–è¯‘å‹è¯­è¨€ |
| **Gin** | 1.9+ | Webæ¡†æ¶ | è½»é‡çº§ã€é«˜æ€§èƒ½ã€ä¸­é—´ä»¶ä¸°å¯Œã€è·¯ç”±çµæ´» |
| **GORM** | 1.25+ | ORMæ¡†æ¶ | åŠŸèƒ½å®Œå–„ã€æ”¯æŒå¤šæ•°æ®åº“ã€è‡ªåŠ¨è¿ç§» |
| **MySQL** | 8.0+ | å…³ç³»æ•°æ®åº“ | æˆç†Ÿç¨³å®šã€äº‹åŠ¡æ”¯æŒã€é«˜å¯ç”¨æ–¹æ¡ˆæˆç†Ÿ |
| **Redis** | 7.0+ | ç¼“å­˜æ•°æ®åº“ | é«˜æ€§èƒ½ã€æ”¯æŒå¤šç§æ•°æ®ç»“æ„ã€æŒä¹…åŒ– |
| **Casbin** | 2.77+ | æƒé™å¼•æ“ | çµæ´»çš„RBAC/ABACæ”¯æŒã€ç­–ç•¥å³ä»£ç  |
| **JWT** | 5.3+ | ä»¤ç‰Œæ ‡å‡† | æ— çŠ¶æ€ã€è·¨åŸŸæ”¯æŒã€æ ‡å‡†åŒ– |
| **TOTP** | 1.4+ | åŒå› ç´ è®¤è¯ | RFC 6238æ ‡å‡†ã€å®‰å…¨å¯é  |
| **WebAuthn** | 0.15+ | æ— å¯†ç è®¤è¯ | W3Cæ ‡å‡†ã€ç°ä»£åŒ–ã€å®‰å…¨æ€§é«˜ |
| **Prometheus** | 1.20+ | ç›‘æ§æŒ‡æ ‡ | ä¸šç•Œæ ‡å‡†ã€ç”Ÿæ€å®Œå–„ã€æ—¶åºæ•°æ®åº“ |
| **bcrypt** | - | å¯†ç åŠ å¯† | è‡ªé€‚åº”å“ˆå¸Œã€é˜²å½©è™¹è¡¨æ”»å‡» |

### 3.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯/æ¡†æ¶ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|----------|------|------|---------|
| **React** | 18.2+ | UIæ¡†æ¶ | ç»„ä»¶åŒ–ã€è™šæ‹ŸDOMã€ç”Ÿæ€ä¸°å¯Œ |
| **TypeScript** | 5.2+ | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ã€å¼€å‘ä½“éªŒå¥½ã€å‡å°‘bug |
| **Vite** | 5.0+ | æ„å»ºå·¥å…· | å¿«é€Ÿã€ç°ä»£åŒ–ã€HMRä½“éªŒå¥½ |
| **React Router** | 6.20+ | è·¯ç”±ç®¡ç† | å£°æ˜å¼è·¯ç”±ã€åµŒå¥—è·¯ç”±ã€ä»£ç åˆ†å‰² |
| **Zustand** | 4.4+ | çŠ¶æ€ç®¡ç† | è½»é‡çº§ã€ç®€å•æ˜“ç”¨ã€æ— æ ·æ¿ä»£ç  |
| **Axios** | 1.6+ | HTTPå®¢æˆ·ç«¯ | æ‹¦æˆªå™¨ã€è¯·æ±‚å–æ¶ˆã€è‡ªåŠ¨è½¬æ¢ |
| **qrcode.react** | 3.1+ | äºŒç»´ç ç”Ÿæˆ | MFAäºŒç»´ç å±•ç¤º |

### 3.3 å¼€å‘ä¸éƒ¨ç½²å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| **Docker** | å®¹å™¨åŒ–éƒ¨ç½² |
| **Docker Compose** | å¤šå®¹å™¨ç¼–æ’ |
| **Git** | ç‰ˆæœ¬æ§åˆ¶ |
| **pnpm** | å‰ç«¯åŒ…ç®¡ç†ï¼ˆæ¯”npmå¿«3å€ï¼‰ |
| **Go Modules** | åç«¯ä¾èµ–ç®¡ç† |
| **Nginx** | åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ |

### 3.4 é¡¹ç›®ç»“æ„

```
Astro-Pass/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”‚   â”œâ”€â”€ config/           # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ config.go     # é…ç½®åŠ è½½
â”‚   â”‚   â”‚   â”œâ”€â”€ validator.go  # é…ç½®éªŒè¯
â”‚   â”‚   â”‚   â”œâ”€â”€ rbac_model.conf  # RBACæ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ abac_model.conf  # ABACæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨å±‚ï¼ˆå¤„ç†HTTPè¯·æ±‚ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_controller.go
â”‚   â”‚   â”‚   â”œâ”€â”€ user_controller.go
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth2_controller.go
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_service.go
â”‚   â”‚   â”‚   â”œâ”€â”€ user_service.go
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth2_service.go
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go
â”‚   â”‚   â”‚   â”œâ”€â”€ oauth2.go
â”‚   â”‚   â”‚   â”œâ”€â”€ webauthn.go
â”‚   â”‚   â”‚   â””â”€â”€ user_session.go
â”‚   â”‚   â”œâ”€â”€ middleware/       # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”‚   â”œâ”€â”€ permission.go
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.go
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ routes/           # è·¯ç”±é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ routes.go
â”‚   â”‚   â”œâ”€â”€ database/         # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚   â””â”€â”€ mysql.go
â”‚   â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ jwt.go
â”‚   â”‚       â”œâ”€â”€ password.go
â”‚   â”‚       â”œâ”€â”€ encryption.go
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ main.go               # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ go.mod                # Goä¾èµ–
â”‚   â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â””â”€â”€ Dockerfile            # Dockeré•œåƒ
â”‚
â”œâ”€â”€ frontend/                  # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ pages/            # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Register.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/        # ç®¡ç†åå°é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ layouts/          # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ AdminLayout.tsx
â”‚   â”‚   â”œâ”€â”€ stores/           # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ authStore.ts
â”‚   â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ App.tsx           # æ ¹ç»„ä»¶
â”‚   â”‚   â””â”€â”€ main.tsx          # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ features/             # åŠŸèƒ½æ–‡æ¡£
â”‚   â”œâ”€â”€ implementation/       # å®ç°æ–‡æ¡£
â”‚   â”œâ”€â”€ deployment/           # éƒ¨ç½²æ–‡æ¡£
â”‚   â””â”€â”€ design/               # è®¾è®¡æ–‡æ¡£
â”‚
â”œâ”€â”€ docker-compose.yml        # Dockerç¼–æ’
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
â””â”€â”€ LICENSE                   # è®¸å¯è¯
```

---

## 4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 4.1 è®¤è¯æ¨¡å—

#### 4.1.1 ç”¨æˆ·æ³¨å†Œ
**åŠŸèƒ½æè¿°ï¼š** æ–°ç”¨æˆ·è´¦æˆ·åˆ›å»º

**å®ç°æµç¨‹ï¼š**
1. å‰ç«¯è¡¨å•éªŒè¯ï¼ˆç”¨æˆ·åã€é‚®ç®±ã€å¯†ç æ ¼å¼ï¼‰
2. åç«¯è¾“å…¥æ¸…ç†ä¸éªŒè¯
3. æ£€æŸ¥ç”¨æˆ·å/é‚®ç®±å”¯ä¸€æ€§
4. å¯†ç åŠ å¯†ï¼ˆbcryptï¼‰
5. ç”ŸæˆUUIDä½œä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†
6. åˆ›å»ºç”¨æˆ·è®°å½•
7. è®°å½•å®¡è®¡æ—¥å¿—
8. å‘é€æ¬¢è¿é‚®ä»¶ï¼ˆå¼‚æ­¥ï¼‰

**å®‰å…¨æªæ–½ï¼š**
- å¯†ç å¤æ‚åº¦éªŒè¯ï¼ˆæœ€å°‘6ä½ï¼‰
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆGORMå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- XSSé˜²æŠ¤ï¼ˆè¾“å…¥æ¸…ç†ï¼‰
- é€Ÿç‡é™åˆ¶ï¼ˆæ¯åˆ†é’Ÿ10æ¬¡ï¼‰

**APIç«¯ç‚¹ï¼š** `POST /api/auth/register`

#### 4.1.2 ç”¨æˆ·ç™»å½•
**åŠŸèƒ½æè¿°ï¼š** ç”¨æˆ·èº«ä»½éªŒè¯

**å®ç°æµç¨‹ï¼š**
1. æ£€æŸ¥è´¦æˆ·é”å®šçŠ¶æ€
2. æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆæ”¯æŒç”¨æˆ·åæˆ–é‚®ç®±ï¼‰
3. éªŒè¯å¯†ç ï¼ˆbcrypt.CompareHashAndPasswordï¼‰
4. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆactive/suspended/deletedï¼‰
5. ç”ŸæˆJWT Access Tokenï¼ˆ15åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
6. ç”ŸæˆRefresh Tokenï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰
7. åˆ›å»ºä¼šè¯è®°å½•ï¼ˆè®°å½•IPã€è®¾å¤‡ã€UserAgentï¼‰
8. æ›´æ–°æœ€åç™»å½•æ—¶é—´å’ŒIP
9. æ¸…é™¤ç™»å½•å¤±è´¥è®°å½•
10. è®°å½•å®¡è®¡æ—¥å¿—

**è´¦æˆ·é”å®šæœºåˆ¶ï¼š**
- 5æ¬¡ç™»å½•å¤±è´¥ â†’ é”å®š30åˆ†é’Ÿ
- æŒ‰ç”¨æˆ·å+IPåŒç»´åº¦è®°å½•
- è‡ªåŠ¨è§£é”æœºåˆ¶

**APIç«¯ç‚¹ï¼š** `POST /api/auth/login`

#### 4.1.3 ä»¤ç‰Œåˆ·æ–°
**åŠŸèƒ½æè¿°ï¼š** ä½¿ç”¨Refresh Tokenè·å–æ–°çš„Access Token

**å®ç°æµç¨‹ï¼š**
1. éªŒè¯Refresh Tokenæœ‰æ•ˆæ€§
2. æ£€æŸ¥Tokenæ˜¯å¦è¢«æ’¤é”€
3. æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
4. ç”Ÿæˆæ–°çš„Access Token
5. ç”Ÿæˆæ–°çš„Refresh Token
6. æ’¤é”€æ—§çš„Refresh Token
7. ä¿å­˜æ–°Tokenåˆ°æ•°æ®åº“

**å®‰å…¨æªæ–½ï¼š**
- Refresh Tokenä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆç”¨åå³åºŸï¼‰
- Tokenè½®æ¢æœºåˆ¶
- æ•°æ®åº“å­˜å‚¨å¯æ’¤é”€

**APIç«¯ç‚¹ï¼š** `POST /api/auth/refresh`

#### 4.1.4 å¯†ç é‡ç½®
**åŠŸèƒ½æè¿°ï¼š** å¿˜è®°å¯†ç åé€šè¿‡é‚®ä»¶é‡ç½®

**å®ç°æµç¨‹ï¼š**
1. ç”¨æˆ·è¾“å…¥é‚®ç®±
2. ç”Ÿæˆé‡ç½®ä»¤ç‰Œï¼ˆUUIDï¼‰
3. å‘é€é‡ç½®é‚®ä»¶ï¼ˆåŒ…å«é‡ç½®é“¾æ¥ï¼‰
4. ç”¨æˆ·ç‚¹å‡»é“¾æ¥è®¿é—®é‡ç½®é¡µé¢
5. éªŒè¯ä»¤ç‰Œæœ‰æ•ˆæ€§ï¼ˆ24å°æ—¶æœ‰æ•ˆæœŸï¼‰
6. ç”¨æˆ·è¾“å…¥æ–°å¯†ç 
7. éªŒè¯å¯†ç ç­–ç•¥
8. æ›´æ–°å¯†ç 
9. æ’¤é”€æ‰€æœ‰ä¼šè¯
10. å‘é€å¯†ç ä¿®æ”¹é€šçŸ¥

**APIç«¯ç‚¹ï¼š** 
- `POST /api/auth/forgot-password` - å‘é€é‡ç½®é‚®ä»¶
- `POST /api/auth/reset-password` - é‡ç½®å¯†ç 

### 4.2 OAuth2/OIDCæ¨¡å—

#### 4.2.1 OAuth2æˆæƒç æµç¨‹
**åŠŸèƒ½æè¿°ï¼š** æ ‡å‡†OAuth 2.0æˆæƒç æ¨¡å¼

**å®ç°æµç¨‹ï¼š**
```
1. ç¬¬ä¸‰æ–¹åº”ç”¨é‡å®šå‘ç”¨æˆ·åˆ°æˆæƒç«¯ç‚¹
   GET /api/oauth2/authorize?
       response_type=code&
       client_id=xxx&
       redirect_uri=xxx&
       scope=openid profile email&
       state=xxx

2. ç”¨æˆ·ç™»å½•ï¼ˆå¦‚æœªç™»å½•ï¼‰

3. æ˜¾ç¤ºæˆæƒåŒæ„é¡µé¢
   - åº”ç”¨åç§°ã€Logo
   - è¯·æ±‚çš„æƒé™èŒƒå›´
   - åŒæ„/æ‹’ç»æŒ‰é’®

4. ç”¨æˆ·åŒæ„åç”Ÿæˆæˆæƒç 
   - æˆæƒç æœ‰æ•ˆæœŸï¼š10åˆ†é’Ÿ
   - ä¸€æ¬¡æ€§ä½¿ç”¨
   - ç»‘å®šclient_idå’Œredirect_uri

5. é‡å®šå‘å›ç¬¬ä¸‰æ–¹åº”ç”¨
   {redirect_uri}?code=xxx&state=xxx

6. ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨æˆæƒç æ¢å–ä»¤ç‰Œ
   POST /api/oauth2/token
   {
     grant_type: "authorization_code",
     code: "xxx",
     client_id: "xxx",
     client_secret: "xxx",
     redirect_uri: "xxx"
   }

7. è¿”å›ä»¤ç‰Œ
   {
     access_token: "xxx",
     token_type: "Bearer",
     expires_in: 900,
     refresh_token: "xxx",
     id_token: "xxx"  // OIDC
   }
```

**æ”¯æŒçš„Grant Typesï¼š**
- âœ… authorization_codeï¼ˆæˆæƒç æ¨¡å¼ï¼‰
- âœ… refresh_tokenï¼ˆåˆ·æ–°ä»¤ç‰Œï¼‰
- â³ client_credentialsï¼ˆå®¢æˆ·ç«¯å‡­è¯ï¼Œå¾…å®ç°ï¼‰
- â³ passwordï¼ˆå¯†ç æ¨¡å¼ï¼Œä¸æ¨èï¼‰

**APIç«¯ç‚¹ï¼š**
- `GET /api/oauth2/authorize` - æˆæƒç«¯ç‚¹
- `POST /api/oauth2/token` - ä»¤ç‰Œç«¯ç‚¹

#### 4.2.2 OIDCç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
**åŠŸèƒ½æè¿°ï¼š** è¿”å›ç”¨æˆ·æ ‡å‡†èº«ä»½ä¿¡æ¯

**è¿”å›æ ¼å¼ï¼ˆç¬¦åˆOIDCæ ‡å‡†ï¼‰ï¼š**
```json
{
  "sub": "user-uuid",
  "name": "ç”¨æˆ·æ˜µç§°",
  "preferred_username": "username",
  "email": "user@example.com",
  "email_verified": true
}
```

**APIç«¯ç‚¹ï¼š** `GET /api/oauth2/userinfo`

#### 4.2.3 JWKSç«¯ç‚¹
**åŠŸèƒ½æè¿°ï¼š** æä¾›å…¬é’¥ç”¨äºéªŒè¯JWTç­¾å

**ç”¨é€”ï¼š** ç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥è·å–å…¬é’¥éªŒè¯ID Tokençš„ç­¾å

**APIç«¯ç‚¹ï¼š** `GET /api/oauth2/jwks`

#### 4.2.4 OIDCå‘ç°ç«¯ç‚¹
**åŠŸèƒ½æè¿°ï¼š** è‡ªåŠ¨é…ç½®ç«¯ç‚¹

**è¿”å›å†…å®¹ï¼š**
```json
{
  "issuer": "http://localhost:8080",
  "authorization_endpoint": "http://localhost:8080/api/oauth2/authorize",
  "token_endpoint": "http://localhost:8080/api/oauth2/token",
  "userinfo_endpoint": "http://localhost:8080/api/oauth2/userinfo",
  "jwks_uri": "http://localhost:8080/api/oauth2/jwks"
}
```

**APIç«¯ç‚¹ï¼š** `GET /.well-known/openid-configuration`

#### 4.2.5 OAuth2å®¢æˆ·ç«¯ç®¡ç†
**åŠŸèƒ½æè¿°ï¼š** ç¬¬ä¸‰æ–¹åº”ç”¨æ¥å…¥ç®¡ç†

**å®¢æˆ·ç«¯ä¿¡æ¯ï¼š**
- Client IDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- Client Secretï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- åº”ç”¨åç§°
- åº”ç”¨Logo
- é‡å®šå‘URIåˆ—è¡¨
- æˆæƒç±»å‹
- æƒé™èŒƒå›´

**APIç«¯ç‚¹ï¼š**
- `POST /api/oauth2/clients` - åˆ›å»ºå®¢æˆ·ç«¯
- `GET /api/oauth2/clients` - è·å–å®¢æˆ·ç«¯åˆ—è¡¨
- `DELETE /api/oauth2/clients/:id` - æ’¤é”€å®¢æˆ·ç«¯

### 4.3 å¤šå› ç´ è®¤è¯ï¼ˆMFAï¼‰æ¨¡å—

#### 4.3.1 TOTPï¼ˆTime-based One-Time Passwordï¼‰
**åŠŸèƒ½æè¿°ï¼š** åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§å¯†ç 

**å®ç°æµç¨‹ï¼š**
1. ç”ŸæˆTOTPå¯†é’¥
2. ç”ŸæˆäºŒç»´ç ï¼ˆåŒ…å«å¯†é’¥å’Œå‘è¡Œè€…ä¿¡æ¯ï¼‰
3. ç”¨æˆ·ä½¿ç”¨Authenticator Appæ‰«æ
4. ç”¨æˆ·è¾“å…¥6ä½éªŒè¯ç 
5. éªŒè¯ç æ­£ç¡®åå¯ç”¨MFA
6. ç”Ÿæˆ10ä¸ªæ¢å¤ç ï¼ˆç”¨äºä¸¢å¤±è®¾å¤‡æ—¶ï¼‰

**æ”¯æŒçš„Authenticator Appï¼š**
- Google Authenticator
- Microsoft Authenticator
- Authy
- 1Password

**APIç«¯ç‚¹ï¼š**
- `POST /api/mfa/generate` - ç”ŸæˆTOTPå¯†é’¥
- `POST /api/mfa/enable` - å¯ç”¨MFA
- `POST /api/mfa/disable` - ç¦ç”¨MFA
- `GET /api/mfa/recovery-codes` - è·å–æ¢å¤ç 

#### 4.3.2 WebAuthnï¼ˆæ— å¯†ç è®¤è¯ï¼‰
**åŠŸèƒ½æè¿°ï¼š** ä½¿ç”¨ç”Ÿç‰©è¯†åˆ«æˆ–ç¡¬ä»¶å¯†é’¥ç™»å½•

**æ”¯æŒçš„è®¤è¯æ–¹å¼ï¼š**
- æŒ‡çº¹è¯†åˆ«ï¼ˆTouch IDã€Windows Helloï¼‰
- é¢éƒ¨è¯†åˆ«ï¼ˆFace IDï¼‰
- ç¡¬ä»¶å®‰å…¨å¯†é’¥ï¼ˆYubiKeyã€Titan Keyï¼‰
- å¹³å°è®¤è¯å™¨ï¼ˆè®¾å¤‡å†…ç½®ï¼‰

**æ³¨å†Œæµç¨‹ï¼š**
1. ç”¨æˆ·ç‚¹å‡»"æ·»åŠ å®‰å…¨å¯†é’¥"
2. åç«¯ç”ŸæˆChallenge
3. å‰ç«¯è°ƒç”¨`navigator.credentials.create()`
4. ç”¨æˆ·å®Œæˆç”Ÿç‰©è¯†åˆ«/æ’å…¥ç¡¬ä»¶å¯†é’¥
5. æµè§ˆå™¨è¿”å›å‡­è¯
6. åç«¯éªŒè¯å¹¶ä¿å­˜å‡­è¯

**ç™»å½•æµç¨‹ï¼š**
1. ç”¨æˆ·ç‚¹å‡»"ä½¿ç”¨å®‰å…¨å¯†é’¥ç™»å½•"
2. åç«¯ç”ŸæˆChallenge
3. å‰ç«¯è°ƒç”¨`navigator.credentials.get()`
4. ç”¨æˆ·å®ŒæˆéªŒè¯
5. åç«¯éªŒè¯ç­¾å
6. ç™»å½•æˆåŠŸ

**APIç«¯ç‚¹ï¼š**
- `POST /api/webauthn/register/begin` - å¼€å§‹æ³¨å†Œ
- `POST /api/webauthn/register/finish` - å®Œæˆæ³¨å†Œ
- `POST /api/webauthn/login/begin` - å¼€å§‹ç™»å½•
- `POST /api/webauthn/login/finish` - å®Œæˆç™»å½•
- `GET /api/webauthn/credentials` - è·å–å‡­è¯åˆ—è¡¨
- `DELETE /api/webauthn/credentials` - åˆ é™¤å‡­è¯

### 4.4 ä¼šè¯ç®¡ç†æ¨¡å—

**åŠŸèƒ½æè¿°ï¼š** è¿½è¸ªå’Œç®¡ç†ç”¨æˆ·çš„æ‰€æœ‰æ´»è·ƒä¼šè¯

**ä¼šè¯ä¿¡æ¯ï¼š**
- ä¼šè¯ID
- ç”¨æˆ·ID
- Refresh Token
- IPåœ°å€
- è®¾å¤‡ç±»å‹ï¼ˆDesktop/Mobile/Tabletï¼‰
- UserAgent
- åˆ›å»ºæ—¶é—´
- æœ€åæ´»åŠ¨æ—¶é—´
- è¿‡æœŸæ—¶é—´

**åŠŸèƒ½ï¼š**
- æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒä¼šè¯
- æ’¤é”€æŒ‡å®šä¼šè¯
- æ’¤é”€æ‰€æœ‰å…¶ä»–ä¼šè¯ï¼ˆä¿ç•™å½“å‰ï¼‰
- è®¾å¤‡è¯†åˆ«

**APIç«¯ç‚¹ï¼š**
- `GET /api/session/list` - è·å–ä¼šè¯åˆ—è¡¨
- `DELETE /api/session/:id` - æ’¤é”€æŒ‡å®šä¼šè¯
- `DELETE /api/session/all` - æ’¤é”€æ‰€æœ‰å…¶ä»–ä¼šè¯

### 4.5 å®¡è®¡æ—¥å¿—æ¨¡å—

**åŠŸèƒ½æè¿°ï¼š** è®°å½•æ‰€æœ‰é‡è¦æ“ä½œå’Œå®‰å…¨äº‹ä»¶

**è®°å½•å†…å®¹ï¼š**
- ç”¨æˆ·ID
- æ“ä½œç±»å‹ï¼ˆlogin, logout, register, update_profileç­‰ï¼‰
- èµ„æºç±»å‹
- èµ„æºID
- IPåœ°å€
- UserAgent
- æ“ä½œçŠ¶æ€ï¼ˆsuccess/failedï¼‰
- è¯¦ç»†æ¶ˆæ¯
- å…ƒæ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
- æ—¶é—´æˆ³

**æ”¯æŒçš„æŸ¥è¯¢ï¼š**
- æŒ‰ç”¨æˆ·æŸ¥è¯¢
- æŒ‰æ“ä½œç±»å‹æŸ¥è¯¢
- æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢
- æŒ‰çŠ¶æ€æŸ¥è¯¢
- åˆ†é¡µæŸ¥è¯¢

**APIç«¯ç‚¹ï¼š**
- `GET /api/audit/logs` - æŸ¥è¯¢å®¡è®¡æ—¥å¿—
- `GET /api/audit/logs/:id` - è·å–æ—¥å¿—è¯¦æƒ…

### 4.6 é€šçŸ¥ç³»ç»Ÿæ¨¡å—

**åŠŸèƒ½æè¿°ï¼š** å‘ç”¨æˆ·å‘é€å®‰å…¨å’Œæ´»åŠ¨é€šçŸ¥

**é€šçŸ¥ç±»å‹ï¼š**
- **å®‰å…¨é€šçŸ¥**ï¼šç™»å½•å¤±è´¥ã€å¯†ç ä¿®æ”¹ã€MFAå˜æ›´
- **æ´»åŠ¨é€šçŸ¥**ï¼šæ–°è®¾å¤‡ç™»å½•ã€ä¼šè¯åˆ›å»º
- **ç³»ç»Ÿé€šçŸ¥**ï¼šç³»ç»Ÿç»´æŠ¤ã€åŠŸèƒ½æ›´æ–°

**é€šçŸ¥æ¸ é“ï¼š**
- ç«™å†…é€šçŸ¥ï¼ˆé€šçŸ¥ä¸­å¿ƒï¼‰
- é‚®ä»¶é€šçŸ¥

**APIç«¯ç‚¹ï¼š**
- `GET /api/notifications` - è·å–é€šçŸ¥åˆ—è¡¨
- `PUT /api/notifications/:id/read` - æ ‡è®°ä¸ºå·²è¯»
- `PUT /api/notifications/read-all` - å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»
- `DELETE /api/notifications/:id` - åˆ é™¤é€šçŸ¥

### 4.7 ç¤¾äº¤ç™»å½•æ¨¡å—

**åŠŸèƒ½æè¿°ï¼š** ä½¿ç”¨ç¬¬ä¸‰æ–¹è´¦å·ç™»å½•

**å½“å‰æ”¯æŒï¼š**
- âœ… GitHub OAuth

**å®ç°æµç¨‹ï¼š**
1. ç”¨æˆ·ç‚¹å‡»"ä½¿ç”¨GitHubç™»å½•"
2. é‡å®šå‘åˆ°GitHubæˆæƒé¡µé¢
3. ç”¨æˆ·æˆæƒ
4. GitHubå›è°ƒè¿”å›æˆæƒç 
5. åç«¯ä½¿ç”¨æˆæƒç æ¢å–Access Token
6. è·å–GitHubç”¨æˆ·ä¿¡æ¯
7. æŸ¥æ‰¾æˆ–åˆ›å»ºæœ¬åœ°ç”¨æˆ·
8. å…³è”ç¤¾äº¤è´¦å·
9. ç”ŸæˆJWT Token
10. ç™»å½•æˆåŠŸ

**æ•°æ®å­˜å‚¨ï¼š**
- Providerï¼ˆgithubï¼‰
- Provider IDï¼ˆGitHubç”¨æˆ·IDï¼‰
- Provider Email
- Access Tokenï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
- Refresh Tokenï¼ˆåŠ å¯†å­˜å‚¨ï¼‰

**APIç«¯ç‚¹ï¼š**
- `GET /api/auth/social/github/url` - è·å–æˆæƒURL
- `POST /api/auth/social/github/callback` - å¤„ç†å›è°ƒ

### 4.8 é‚®ä»¶æœåŠ¡æ¨¡å—

**åŠŸèƒ½æè¿°ï¼š** å‘é€å„ç±»é‚®ä»¶

**é‚®ä»¶ç±»å‹ï¼š**
- æ¬¢è¿é‚®ä»¶ï¼ˆæ³¨å†ŒæˆåŠŸï¼‰
- å¯†ç é‡ç½®é‚®ä»¶
- é‚®ç®±éªŒè¯é‚®ä»¶
- å®‰å…¨é€šçŸ¥é‚®ä»¶

**é‚®ä»¶æ¨¡æ¿ï¼š**
- HTMLæ ¼å¼
- å“åº”å¼è®¾è®¡
- å“ç‰Œé£æ ¼

**SMTPé…ç½®ï¼š**
- æ”¯æŒä¸»æµé‚®ä»¶æœåŠ¡å•†
- TLS/SSLåŠ å¯†
- è®¤è¯æ”¯æŒ

---

## 5. æ•°æ®æ¨¡å‹è®¾è®¡

### 5.1 æ ¸å¿ƒæ•°æ®è¡¨

#### 5.1.1 ç”¨æˆ·è¡¨ï¼ˆusersï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”®ï¼Œè‡ªå¢ | PRIMARY |
| uuid | VARCHAR(36) | ç”¨æˆ·å”¯ä¸€æ ‡è¯† | UNIQUE |
| username | VARCHAR(50) | ç”¨æˆ·å | UNIQUE |
| email | VARCHAR(100) | é‚®ç®± | UNIQUE |
| password_hash | VARCHAR(255) | å¯†ç å“ˆå¸Œ | - |
| nickname | VARCHAR(50) | æ˜µç§° | - |
| avatar | VARCHAR(255) | å¤´åƒURL | - |
| email_verified | BOOLEAN | é‚®ç®±æ˜¯å¦éªŒè¯ | - |
| mfa_enabled | BOOLEAN | MFAæ˜¯å¦å¯ç”¨ | - |
| mfa_secret | VARCHAR(255) | TOTPå¯†é’¥ | - |
| mfa_recovery_codes | TEXT | æ¢å¤ç ï¼ˆJSONï¼‰ | - |
| status | VARCHAR(20) | çŠ¶æ€ï¼ˆactive/suspended/deletedï¼‰ | INDEX |
| last_login_at | TIMESTAMP | æœ€åç™»å½•æ—¶é—´ | - |
| last_login_ip | VARCHAR(45) | æœ€åç™»å½•IP | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤æ—¶é—´ | INDEX |

**å…³è”å…³ç³»ï¼š**
- å¤šå¯¹å¤šï¼šrolesï¼ˆé€šè¿‡user_rolesä¸­é—´è¡¨ï¼‰
- ä¸€å¯¹å¤šï¼šoauth2_clients, refresh_tokens, audit_logs, user_sessions

#### 5.1.2 è§’è‰²è¡¨ï¼ˆrolesï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| name | VARCHAR(50) | è§’è‰²åç§°ï¼ˆå”¯ä¸€ï¼‰ | UNIQUE |
| display_name | VARCHAR(100) | æ˜¾ç¤ºåç§° | - |
| description | TEXT | æè¿° | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

**é¢„è®¾è§’è‰²ï¼š**
- adminï¼šç®¡ç†å‘˜
- userï¼šæ™®é€šç”¨æˆ·

#### 5.1.3 æƒé™è¡¨ï¼ˆpermissionsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| name | VARCHAR(100) | æƒé™åç§° | UNIQUE |
| display_name | VARCHAR(100) | æ˜¾ç¤ºåç§° | - |
| resource | VARCHAR(100) | èµ„æºç±»å‹ | INDEX |
| action | VARCHAR(50) | æ“ä½œç±»å‹ | INDEX |
| description | TEXT | æè¿° | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

**æƒé™æ ¼å¼ï¼š** `resource:action`
- ç¤ºä¾‹ï¼š`user:read`, `user:write`, `role:read`

#### 5.1.4 OAuth2å®¢æˆ·ç«¯è¡¨ï¼ˆoauth2_clientsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | æ‰€å±ç”¨æˆ· | INDEX |
| client_id | VARCHAR(100) | å®¢æˆ·ç«¯ID | UNIQUE |
| client_secret | VARCHAR(255) | å®¢æˆ·ç«¯å¯†é’¥ | - |
| client_name | VARCHAR(100) | åº”ç”¨åç§° | - |
| client_uri | VARCHAR(255) | åº”ç”¨URL | - |
| logo_uri | VARCHAR(255) | Logo URL | - |
| redirect_uris | TEXT | é‡å®šå‘URIï¼ˆJSONæ•°ç»„ï¼‰ | - |
| grant_types | TEXT | æˆæƒç±»å‹ï¼ˆJSONæ•°ç»„ï¼‰ | - |
| response_types | TEXT | å“åº”ç±»å‹ï¼ˆJSONæ•°ç»„ï¼‰ | - |
| scope | VARCHAR(255) | æƒé™èŒƒå›´ | - |
| status | VARCHAR(20) | çŠ¶æ€ï¼ˆactive/suspended/revokedï¼‰ | INDEX |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

#### 5.1.5 æˆæƒç è¡¨ï¼ˆauthorization_codesï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| code | VARCHAR(255) | æˆæƒç  | UNIQUE |
| oauth2_client_id | UINT | å®¢æˆ·ç«¯IDï¼ˆå¤–é”®ï¼‰ | INDEX |
| client_id | VARCHAR(100) | å®¢æˆ·ç«¯IDï¼ˆå­—ç¬¦ä¸²ï¼‰ | INDEX |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| redirect_uri | VARCHAR(255) | é‡å®šå‘URI | - |
| scope | VARCHAR(255) | æƒé™èŒƒå›´ | - |
| code_challenge | VARCHAR(255) | PKCE Challenge | - |
| code_challenge_method | VARCHAR(20) | PKCEæ–¹æ³• | - |
| expires_at | TIMESTAMP | è¿‡æœŸæ—¶é—´ | INDEX |
| used | BOOLEAN | æ˜¯å¦å·²ä½¿ç”¨ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

#### 5.1.6 è®¿é—®ä»¤ç‰Œè¡¨ï¼ˆaccess_tokensï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| token | VARCHAR(500) | è®¿é—®ä»¤ç‰Œ | UNIQUE |
| oauth2_client_id | UINT | å®¢æˆ·ç«¯IDï¼ˆå¤–é”®ï¼‰ | INDEX |
| client_id | VARCHAR(100) | å®¢æˆ·ç«¯IDï¼ˆå­—ç¬¦ä¸²ï¼‰ | INDEX |
| user_id | UINT | ç”¨æˆ·IDï¼ˆå¯ä¸ºç©ºï¼‰ | INDEX |
| scope | VARCHAR(255) | æƒé™èŒƒå›´ | - |
| expires_at | TIMESTAMP | è¿‡æœŸæ—¶é—´ | INDEX |
| revoked | BOOLEAN | æ˜¯å¦æ’¤é”€ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

#### 5.1.7 åˆ·æ–°ä»¤ç‰Œè¡¨ï¼ˆrefresh_tokensï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| token | VARCHAR(255) | åˆ·æ–°ä»¤ç‰Œ | UNIQUE |
| client_id | VARCHAR(100) | å®¢æˆ·ç«¯ID | - |
| expires_at | TIMESTAMP | è¿‡æœŸæ—¶é—´ | INDEX |
| revoked | BOOLEAN | æ˜¯å¦æ’¤é”€ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

#### 5.1.8 ç”¨æˆ·ä¼šè¯è¡¨ï¼ˆuser_sessionsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| refresh_token | VARCHAR(255) | å…³è”çš„åˆ·æ–°ä»¤ç‰Œ | INDEX |
| ip_address | VARCHAR(45) | IPåœ°å€ | - |
| user_agent | VARCHAR(255) | UserAgent | - |
| device_type | VARCHAR(50) | è®¾å¤‡ç±»å‹ | - |
| last_activity_at | TIMESTAMP | æœ€åæ´»åŠ¨æ—¶é—´ | - |
| expires_at | TIMESTAMP | è¿‡æœŸæ—¶é—´ | INDEX |
| revoked | BOOLEAN | æ˜¯å¦æ’¤é”€ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |

#### 5.1.9 å®¡è®¡æ—¥å¿—è¡¨ï¼ˆaudit_logsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·IDï¼ˆå¯ä¸ºç©ºï¼‰ | INDEX |
| action | VARCHAR(50) | æ“ä½œç±»å‹ | INDEX |
| resource | VARCHAR(100) | èµ„æºç±»å‹ | - |
| resource_id | VARCHAR(100) | èµ„æºID | - |
| ip | VARCHAR(45) | IPåœ°å€ | - |
| user_agent | VARCHAR(255) | UserAgent | - |
| status | VARCHAR(20) | çŠ¶æ€ï¼ˆsuccess/failedï¼‰ | - |
| message | TEXT | æ¶ˆæ¯ | - |
| metadata | TEXT | å…ƒæ•°æ®ï¼ˆJSONï¼‰ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | INDEX |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

#### 5.1.10 ç™»å½•å°è¯•è¡¨ï¼ˆlogin_attemptsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| username | VARCHAR(100) | ç”¨æˆ·å | INDEX |
| ip_address | VARCHAR(45) | IPåœ°å€ | INDEX |
| success | BOOLEAN | æ˜¯å¦æˆåŠŸ | - |
| failure_reason | VARCHAR(255) | å¤±è´¥åŸå›  | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | INDEX |

**å¤åˆç´¢å¼•ï¼š** (username, ip_address, created_at)

#### 5.1.11 WebAuthnå‡­è¯è¡¨ï¼ˆwebauthn_credentialsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| credential_id | VARCHAR(255) | å‡­è¯ID | UNIQUE |
| public_key | TEXT | å…¬é’¥ | - |
| counter | UINT | ç­¾åè®¡æ•°å™¨ | - |
| aaguid | VARCHAR(36) | è®¤è¯å™¨GUID | - |
| device_name | VARCHAR(100) | è®¾å¤‡åç§° | - |
| device_type | VARCHAR(50) | è®¾å¤‡ç±»å‹ | - |
| last_used_at | TIMESTAMP | æœ€åä½¿ç”¨æ—¶é—´ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

#### 5.1.12 ç¤¾äº¤ç™»å½•è¡¨ï¼ˆsocial_authsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| provider | VARCHAR(50) | æä¾›å•†ï¼ˆgithub/wechatï¼‰ | INDEX |
| provider_id | VARCHAR(255) | æä¾›å•†ç”¨æˆ·ID | - |
| provider_email | VARCHAR(255) | æä¾›å•†é‚®ç®± | - |
| access_token | TEXT | è®¿é—®ä»¤ç‰Œï¼ˆåŠ å¯†ï¼‰ | - |
| refresh_token | TEXT | åˆ·æ–°ä»¤ç‰Œï¼ˆåŠ å¯†ï¼‰ | - |
| token_expires_at | TIMESTAMP | ä»¤ç‰Œè¿‡æœŸæ—¶é—´ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |
| deleted_at | TIMESTAMP | è½¯åˆ é™¤ | INDEX |

**å¤åˆç´¢å¼•ï¼š** (provider, provider_id)

#### 5.1.13 é‚®ç®±éªŒè¯è¡¨ï¼ˆemail_verificationsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| email | VARCHAR(255) | é‚®ç®± | INDEX |
| token | VARCHAR(255) | éªŒè¯ä»¤ç‰Œ | UNIQUE |
| verified | BOOLEAN | æ˜¯å¦å·²éªŒè¯ | - |
| expires_at | TIMESTAMP | è¿‡æœŸæ—¶é—´ | INDEX |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | - |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ | - |

#### 5.1.14 å¯†ç å†å²è¡¨ï¼ˆpassword_historiesï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·ID | INDEX |
| password_hash | VARCHAR(255) | å¯†ç å“ˆå¸Œ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | INDEX |

**ç”¨é€”ï¼š** é˜²æ­¢ç”¨æˆ·é‡å¤ä½¿ç”¨æœ€è¿‘Nä¸ªå¯†ç 

#### 5.1.15 é€šçŸ¥è¡¨ï¼ˆnotificationsï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç´¢å¼• |
|--------|------|------|------|
| id | UINT | ä¸»é”® | PRIMARY |
| user_id | UINT | ç”¨æˆ·IDï¼ˆå¯ä¸ºç©ºï¼‰ | INDEX |
| type | VARCHAR(50) | ç±»å‹ï¼ˆsecurity/activity/systemï¼‰ | INDEX |
| title | VARCHAR(255) | æ ‡é¢˜ | - |
| message | TEXT | æ¶ˆæ¯å†…å®¹ | - |
| read | BOOLEAN | æ˜¯å¦å·²è¯» | INDEX |
| read_at | TIMESTAMP | é˜…è¯»æ—¶é—´ | - |
| metadata | TEXT | å…ƒæ•°æ®ï¼ˆJSONï¼‰ | - |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ | INDEX |

### 5.2 æ•°æ®åº“å…³ç³»å›¾

```
users (ç”¨æˆ·)
  â”œâ”€ 1:N â†’ refresh_tokens (åˆ·æ–°ä»¤ç‰Œ)
  â”œâ”€ 1:N â†’ oauth2_clients (OAuth2å®¢æˆ·ç«¯)
  â”œâ”€ 1:N â†’ user_sessions (ä¼šè¯)
  â”œâ”€ 1:N â†’ audit_logs (å®¡è®¡æ—¥å¿—)
  â”œâ”€ 1:N â†’ webauthn_credentials (WebAuthnå‡­è¯)
  â”œâ”€ 1:N â†’ social_auths (ç¤¾äº¤ç™»å½•)
  â”œâ”€ 1:N â†’ notifications (é€šçŸ¥)
  â””â”€ M:N â†’ roles (è§’è‰²) [é€šè¿‡ user_roles]

roles (è§’è‰²)
  â”œâ”€ M:N â†’ users (ç”¨æˆ·) [é€šè¿‡ user_roles]
  â””â”€ M:N â†’ permissions (æƒé™) [é€šè¿‡ role_permissions]

permissions (æƒé™)
  â””â”€ M:N â†’ roles (è§’è‰²) [é€šè¿‡ role_permissions]

oauth2_clients (OAuth2å®¢æˆ·ç«¯)
  â”œâ”€ N:1 â†’ users (ç”¨æˆ·)
  â”œâ”€ 1:N â†’ authorization_codes (æˆæƒç )
  â””â”€ 1:N â†’ access_tokens (è®¿é—®ä»¤ç‰Œ)

authorization_codes (æˆæƒç )
  â”œâ”€ N:1 â†’ oauth2_clients (å®¢æˆ·ç«¯)
  â””â”€ N:1 â†’ users (ç”¨æˆ·)

access_tokens (è®¿é—®ä»¤ç‰Œ)
  â”œâ”€ N:1 â†’ oauth2_clients (å®¢æˆ·ç«¯)
  â””â”€ N:1 â†’ users (ç”¨æˆ·)
```

### 5.3 ç´¢å¼•ç­–ç•¥

**é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼š**
- users: username, email, uuid, status
- refresh_tokens: token, user_id, expires_at
- audit_logs: user_id, action, created_at
- user_sessions: user_id, refresh_token, expires_at
- login_attempts: (username, ip_address, created_at)

**è½¯åˆ é™¤ç´¢å¼•ï¼š**
- æ‰€æœ‰æ”¯æŒè½¯åˆ é™¤çš„è¡¨éƒ½åœ¨deleted_atå­—æ®µä¸Šå»ºç«‹ç´¢å¼•

---

## 6. APIæ¥å£è®¾è®¡

### 6.1 è®¤è¯ç›¸å…³API

#### 6.1.1 ç”¨æˆ·æ³¨å†Œ
```
POST /api/auth/register
Content-Type: application/json

Request:
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Password123!",
  "nickname": "æµ‹è¯•ç”¨æˆ·"
}

Response (200):
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "user": {
      "id": 1,
      "uuid": "xxx-xxx-xxx",
      "username": "testuser",
      "email": "test@example.com",
      "nickname": "æµ‹è¯•ç”¨æˆ·"
    }
  }
}
```

#### 6.1.2 ç”¨æˆ·ç™»å½•
```
POST /api/auth/login
Content-Type: application/json

Request:
{
  "username": "testuser",  // æˆ–é‚®ç®±
  "password": "Password123!"
}

Response (200):
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGc...",
    "refresh_token": "xxx...",
    "token_type": "Bearer",
    "expires_in": 900,
    "user": {
      "id": 1,
      "username": "testuser",
      "email": "test@example.com",
      "mfa_enabled": false
    }
  }
}
```

#### 6.1.3 åˆ·æ–°ä»¤ç‰Œ
```
POST /api/auth/refresh
Content-Type: application/json

Request:
{
  "refresh_token": "xxx..."
}

Response (200):
{
  "code": 200,
  "message": "ä»¤ç‰Œåˆ·æ–°æˆåŠŸ",
  "data": {
    "access_token": "eyJhbGc...",
    "refresh_token": "yyy...",
    "expires_in": 900
  }
}
```

#### 6.1.4 è·å–ç”¨æˆ·ä¿¡æ¯
```
GET /api/auth/profile
Authorization: Bearer {access_token}

Response (200):
{
  "code": 200,
  "data": {
    "id": 1,
    "uuid": "xxx-xxx-xxx",
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://...",
    "email_verified": true,
    "mfa_enabled": false,
    "roles": [
      {
        "id": 1,
        "name": "user",
        "display_name": "æ™®é€šç”¨æˆ·"
      }
    ]
  }
}
```

### 6.2 OAuth2/OIDC API

#### 6.2.1 æˆæƒç«¯ç‚¹
```
GET /api/oauth2/authorize?
    response_type=code&
    client_id=xxx&
    redirect_uri=https://app.example.com/callback&
    scope=openid profile email&
    state=random_state

Response: é‡å®šå‘åˆ°æˆæƒåŒæ„é¡µé¢æˆ–ç›´æ¥è¿”å›æˆæƒç 
```

#### 6.2.2 ä»¤ç‰Œç«¯ç‚¹
```
POST /api/oauth2/token
Content-Type: application/x-www-form-urlencoded

Request:
grant_type=authorization_code&
code=xxx&
client_id=xxx&
client_secret=xxx&
redirect_uri=https://app.example.com/callback

Response (200):
{
  "access_token": "eyJhbGc...",
  "token_type": "Bearer",
  "expires_in": 900,
  "refresh_token": "xxx...",
  "id_token": "eyJhbGc..."  // OIDC
}
```

#### 6.2.3 ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹
```
GET /api/oauth2/userinfo
Authorization: Bearer {access_token}

Response (200):
{
  "sub": "user-uuid",
  "name": "æµ‹è¯•ç”¨æˆ·",
  "preferred_username": "testuser",
  "email": "test@example.com",
  "email_verified": true
}
```

#### 6.2.4 åˆ›å»ºOAuth2å®¢æˆ·ç«¯
```
POST /api/oauth2/clients
Authorization: Bearer {access_token}
Content-Type: application/json

Request:
{
  "client_name": "æˆ‘çš„åº”ç”¨",
  "client_uri": "https://myapp.com",
  "logo_uri": "https://myapp.com/logo.png",
  "redirect_uris": [
    "https://myapp.com/callback"
  ]
}

Response (200):
{
  "code": 200,
  "data": {
    "client_id": "xxx...",
    "client_secret": "yyy...",
    "client_name": "æˆ‘çš„åº”ç”¨",
    "redirect_uris": ["https://myapp.com/callback"]
  }
}
```

### 6.3 MFA API

#### 6.3.1 ç”ŸæˆTOTPå¯†é’¥
```
POST /api/mfa/generate
Authorization: Bearer {access_token}

Response (200):
{
  "code": 200,
  "data": {
    "secret": "JBSWY3DPEHPK3PXP",
    "qr_code": "data:image/png;base64,...",
    "issuer": "æ˜Ÿç©¹é€šè¡Œè¯",
    "account": "testuser"
  }
}
```

#### 6.3.2 å¯ç”¨MFA
```
POST /api/mfa/enable
Authorization: Bearer {access_token}
Content-Type: application/json

Request:
{
  "secret": "JBSWY3DPEHPK3PXP",
  "code": "123456"
}

Response (200):
{
  "code": 200,
  "message": "MFAå·²å¯ç”¨",
  "data": {
    "recovery_codes": [
      "ABCD-1234",
      "EFGH-5678",
      ...
    ]
  }
}
```

### 6.4 ä¼šè¯ç®¡ç†API

#### 6.4.1 è·å–ä¼šè¯åˆ—è¡¨
```
GET /api/session/list
Authorization: Bearer {access_token}

Response (200):
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "device_type": "desktop",
      "ip_address": "192.168.1.1",
      "user_agent": "Mozilla/5.0...",
      "last_activity_at": "2025-11-28T10:00:00Z",
      "created_at": "2025-11-28T09:00:00Z",
      "is_current": true
    }
  ]
}
```

#### 6.4.2 æ’¤é”€ä¼šè¯
```
DELETE /api/session/:id
Authorization: Bearer {access_token}

Response (200):
{
  "code": 200,
  "message": "ä¼šè¯å·²æ’¤é”€"
}
```

### 6.5 å®¡è®¡æ—¥å¿—API

#### 6.5.1 æŸ¥è¯¢å®¡è®¡æ—¥å¿—
```
GET /api/audit/logs?
    page=1&
    page_size=20&
    action=login&
    start_time=2025-11-01&
    end_time=2025-11-30
Authorization: Bearer {access_token}

Response (200):
{
  "code": 200,
  "data": {
    "logs": [
      {
        "id": 1,
        "user_id": 1,
        "action": "login",
        "resource": "user",
        "ip": "192.168.1.1",
        "status": "success",
        "message": "ç™»å½•æˆåŠŸ",
        "created_at": "2025-11-28T10:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

### 6.6 ç®¡ç†å‘˜API

#### 6.6.1 è·å–æ‰€æœ‰ç”¨æˆ·
```
GET /api/admin/users?page=1&page_size=20
Authorization: Bearer {access_token}
Permission: user:read

Response (200):
{
  "code": 200,
  "data": {
    "users": [...],
    "total": 100,
    "page": 1,
    "page_size": 20
  }
}
```

#### 6.6.2 åˆ›å»ºè§’è‰²
```
POST /api/permission/role
Authorization: Bearer {access_token}
Content-Type: application/json

Request:
{
  "name": "editor",
  "display_name": "ç¼–è¾‘è€…",
  "description": "å¯ä»¥ç¼–è¾‘å†…å®¹"
}

Response (200):
{
  "code": 200,
  "data": {
    "id": 3,
    "name": "editor",
    "display_name": "ç¼–è¾‘è€…"
  }
}
```

### 6.7 å¥åº·æ£€æŸ¥API

#### 6.7.1 å¥åº·æ£€æŸ¥
```
GET /health

Response (200):
{
  "status": "healthy",
  "timestamp": "2025-11-28T10:00:00Z",
  "version": "2.0.0"
}
```

#### 6.7.2 å°±ç»ªæ£€æŸ¥
```
GET /ready

Response (200):
{
  "status": "ready",
  "checks": {
    "database": "ok",
    "redis": "ok"
  }
}
```

#### 6.7.3 PrometheusæŒ‡æ ‡
```
GET /metrics

Response: Prometheusæ ¼å¼çš„æŒ‡æ ‡æ•°æ®
```

### 6.8 ç»Ÿä¸€å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

#### é”™è¯¯å“åº”
```json
{
  "code": 400,
  "message": "é”™è¯¯æè¿°",
  "error": "ERROR_CODE"
}
```

#### å¸¸è§é”™è¯¯ç 
| HTTPçŠ¶æ€ç  | é”™è¯¯ç  | è¯´æ˜ |
|-----------|--------|------|
| 400 | BAD_REQUEST | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | UNAUTHORIZED | æœªè®¤è¯ |
| 403 | FORBIDDEN | æ— æƒé™ |
| 404 | NOT_FOUND | èµ„æºä¸å­˜åœ¨ |
| 409 | CONFLICT | èµ„æºå†²çª |
| 429 | TOO_MANY_REQUESTS | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | INTERNAL_ERROR | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

---

## 7. å®‰å…¨æ¶æ„è®¾è®¡

### 7.1 å¤šå±‚å®‰å…¨é˜²æŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬1å±‚ï¼šç½‘ç»œå±‚                         â”‚
â”‚  - HTTPS/TLSåŠ å¯†ä¼ è¾“                                    â”‚
â”‚  - é˜²ç«å¢™è§„åˆ™                                           â”‚
â”‚  - DDoSé˜²æŠ¤                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬2å±‚ï¼šAPIç½‘å…³å±‚                      â”‚
â”‚  - é€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰                            â”‚
â”‚  - IPç™½åå•/é»‘åå•                                      â”‚
â”‚  - è¯·æ±‚å¤§å°é™åˆ¶                                         â”‚
â”‚  - æ¶æ„è¯·æ±‚è¿‡æ»¤                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬3å±‚ï¼šåº”ç”¨å±‚                         â”‚
â”‚  - è¾“å…¥éªŒè¯ä¸æ¸…ç†                                       â”‚
â”‚  - SQLæ³¨å…¥é˜²æŠ¤ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰                            â”‚
â”‚  - XSSé˜²æŠ¤ï¼ˆè¾“å‡ºè½¬ä¹‰ï¼‰                                  â”‚
â”‚  - CSRFé˜²æŠ¤                                             â”‚
â”‚  - å®‰å…¨å“åº”å¤´                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬4å±‚ï¼šè®¤è¯å±‚                         â”‚
â”‚  - JWTä»¤ç‰ŒéªŒè¯                                          â”‚
â”‚  - ä»¤ç‰Œè¿‡æœŸæ£€æŸ¥                                         â”‚
â”‚  - ä»¤ç‰Œé»‘åå•                                           â”‚
â”‚  - å¤šå› ç´ è®¤è¯                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬5å±‚ï¼šæˆæƒå±‚                         â”‚
â”‚  - RBACæƒé™æ£€æŸ¥                                         â”‚
â”‚  - ABACç­–ç•¥è¯„ä¼°                                         â”‚
â”‚  - èµ„æºè®¿é—®æ§åˆ¶                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬6å±‚ï¼šæ•°æ®å±‚                         â”‚
â”‚  - å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰                               â”‚
â”‚  - æ•æ„Ÿæ•°æ®åŠ å¯†ï¼ˆAES-256ï¼‰                              â”‚
â”‚  - æ•°æ®åº“è®¿é—®æ§åˆ¶                                       â”‚
â”‚  - å®¡è®¡æ—¥å¿—è®°å½•                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å¯†ç å®‰å…¨

#### 7.2.1 å¯†ç å­˜å‚¨
- **ç®—æ³•ï¼š** bcryptï¼ˆè‡ªé€‚åº”å“ˆå¸Œï¼‰
- **æˆæœ¬å› å­ï¼š** 10ï¼ˆå¯é…ç½®ï¼‰
- **ç›å€¼ï¼š** è‡ªåŠ¨ç”Ÿæˆï¼Œæ¯ä¸ªå¯†ç ç‹¬ç«‹
- **ä¸å¯é€†ï¼š** æ— æ³•ä»å“ˆå¸Œè¿˜åŸåŸå¯†ç 

#### 7.2.2 å¯†ç ç­–ç•¥
```go
// å¯†ç å¤æ‚åº¦è¦æ±‚
- æœ€å°é•¿åº¦ï¼š8ä½
- å¿…é¡»åŒ…å«ï¼šå¤§å†™å­—æ¯
- å¿…é¡»åŒ…å«ï¼šå°å†™å­—æ¯
- å¿…é¡»åŒ…å«ï¼šæ•°å­—
- å¿…é¡»åŒ…å«ï¼šç‰¹æ®Šå­—ç¬¦
- å¯†ç å†å²ï¼šä¸èƒ½é‡å¤æœ€è¿‘5ä¸ªå¯†ç 
- å¯†ç æœ‰æ•ˆæœŸï¼š90å¤©ï¼ˆå¯é…ç½®ï¼‰
```

#### 7.2.3 å¯†ç é‡ç½®
- é‡ç½®ä»¤ç‰Œï¼šUUIDæ ¼å¼ï¼Œä¸€æ¬¡æ€§ä½¿ç”¨
- æœ‰æ•ˆæœŸï¼š24å°æ—¶
- å‘é€æ–¹å¼ï¼šé‚®ä»¶
- é‡ç½®åï¼šæ’¤é”€æ‰€æœ‰ä¼šè¯

### 7.3 ä»¤ç‰Œå®‰å…¨

#### 7.3.1 JWTä»¤ç‰Œè®¾è®¡
```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "user_id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "exp": 1700000000,
    "iat": 1699999100
  },
  "signature": "..."
}
```

**å®‰å…¨æªæ–½ï¼š**
- ç­¾åç®—æ³•ï¼šHS256ï¼ˆHMAC-SHA256ï¼‰
- å¯†é’¥é•¿åº¦ï¼šè‡³å°‘32å­—èŠ‚
- Access Tokenæœ‰æ•ˆæœŸï¼š15åˆ†é’Ÿ
- Refresh Tokenæœ‰æ•ˆæœŸï¼š7å¤©
- ä»¤ç‰Œè½®æ¢ï¼šåˆ·æ–°æ—¶ç”Ÿæˆæ–°Token

#### 7.3.2 ä»¤ç‰Œæ’¤é”€æœºåˆ¶
- Refresh Tokenå­˜å‚¨åœ¨æ•°æ®åº“ï¼Œå¯æ’¤é”€
- ä¼šè¯æ’¤é”€æ—¶åŒæ—¶æ’¤é”€å…³è”Token
- å¯†ç ä¿®æ”¹æ—¶æ’¤é”€æ‰€æœ‰Token
- æ”¯æŒé»‘åå•æœºåˆ¶ï¼ˆRedisï¼‰

### 7.4 è´¦æˆ·å®‰å…¨

#### 7.4.1 è´¦æˆ·é”å®šæœºåˆ¶
```
ç™»å½•å¤±è´¥æ¬¡æ•° â†’ é”å®šæ—¶é•¿
1-2æ¬¡        â†’ æ— é”å®š
3-4æ¬¡        â†’ è­¦å‘Š
5æ¬¡åŠä»¥ä¸Š    â†’ é”å®š30åˆ†é’Ÿ

è®°å½•ç»´åº¦ï¼š
- ç”¨æˆ·å + IPåœ°å€
- æ»‘åŠ¨æ—¶é—´çª—å£ï¼š15åˆ†é’Ÿ

è§£é”æ–¹å¼ï¼š
- è‡ªåŠ¨è§£é”ï¼ˆæ—¶é—´åˆ°æœŸï¼‰
- ç®¡ç†å‘˜æ‰‹åŠ¨è§£é”
- å¯†ç é‡ç½®è§£é”
```

#### 7.4.2 ä¼šè¯ç®¡ç†
- å•ç”¨æˆ·å¤šä¼šè¯æ”¯æŒ
- ä¼šè¯è¶…æ—¶ï¼š7å¤©æ— æ´»åŠ¨
- è®¾å¤‡è¯†åˆ«ï¼šUserAgentè§£æ
- å¼‚å¸¸ç™»å½•æ£€æµ‹ï¼šæ–°è®¾å¤‡/æ–°åœ°ç‚¹

#### 7.4.3 å®‰å…¨é€šçŸ¥
è§¦å‘é€šçŸ¥çš„äº‹ä»¶ï¼š
- æ–°è®¾å¤‡ç™»å½•
- å¯†ç ä¿®æ”¹
- MFAå¯ç”¨/ç¦ç”¨
- ä¼šè¯æ’¤é”€
- ç™»å½•å¤±è´¥ï¼ˆè¿ç»­3æ¬¡ï¼‰
- è´¦æˆ·é”å®š

### 7.5 APIå®‰å…¨

#### 7.5.1 é€Ÿç‡é™åˆ¶
```
å…¨å±€é™åˆ¶ï¼š
- æ¯åˆ†é’Ÿ60æ¬¡è¯·æ±‚

è®¤è¯æ¥å£ï¼š
- ç™»å½•ï¼šæ¯åˆ†é’Ÿ10æ¬¡
- æ³¨å†Œï¼šæ¯åˆ†é’Ÿ5æ¬¡
- å¯†ç é‡ç½®ï¼šæ¯å°æ—¶3æ¬¡

å®ç°æ–¹å¼ï¼š
- æ»‘åŠ¨çª—å£ç®—æ³•
- Redisè®¡æ•°å™¨
- æŒ‰IPåœ°å€é™åˆ¶
```

#### 7.5.2 å®‰å…¨å“åº”å¤´
```http
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src 'self'
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=(), camera=()
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

#### 7.5.3 CORSé…ç½®
```go
AllowOrigins: ["http://localhost:3000"]  // ç”Ÿäº§ç¯å¢ƒé…ç½®å®é™…åŸŸå
AllowMethods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
AllowHeaders: ["Origin", "Content-Type", "Authorization"]
AllowCredentials: true
MaxAge: 12 * time.Hour
```

### 7.6 è¾“å…¥éªŒè¯

#### 7.6.1 éªŒè¯è§„åˆ™
```go
// ç”¨æˆ·å
- é•¿åº¦ï¼š3-50å­—ç¬¦
- å­—ç¬¦ï¼šå­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- æ­£åˆ™ï¼š^[a-zA-Z0-9_]{3,50}$

// é‚®ç®±
- æ ‡å‡†é‚®ç®±æ ¼å¼
- æ­£åˆ™ï¼š^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$

// å¯†ç 
- é•¿åº¦ï¼š6-128å­—ç¬¦
- å¤æ‚åº¦ï¼šè§å¯†ç ç­–ç•¥

// æ˜µç§°
- é•¿åº¦ï¼š1-50å­—ç¬¦
- å…è®¸ä¸­æ–‡ã€å­—æ¯ã€æ•°å­—
```

#### 7.6.2 è¾“å…¥æ¸…ç†
```go
// XSSé˜²æŠ¤
- HTMLæ ‡ç­¾è¿‡æ»¤
- ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰
- JavaScriptä»£ç è¿‡æ»¤

// SQLæ³¨å…¥é˜²æŠ¤
- ä½¿ç”¨GORMå‚æ•°åŒ–æŸ¥è¯¢
- ç¦æ­¢æ‹¼æ¥SQL
- è¾“å…¥ç±»å‹éªŒè¯
```

### 7.7 æ•°æ®åŠ å¯†

#### 7.7.1 ä¼ è¾“åŠ å¯†
- **åè®®ï¼š** TLS 1.2+
- **è¯ä¹¦ï¼š** Let's Encryptï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **å¼ºåˆ¶HTTPSï¼š** é‡å®šå‘HTTPåˆ°HTTPS

#### 7.7.2 å­˜å‚¨åŠ å¯†
```go
// å¯†ç 
- ç®—æ³•ï¼šbcrypt
- æˆæœ¬ï¼š10

// æ•æ„Ÿä»¤ç‰Œï¼ˆç¤¾äº¤ç™»å½•ï¼‰
- ç®—æ³•ï¼šAES-256-GCM
- å¯†é’¥ï¼šç¯å¢ƒå˜é‡é…ç½®
- IVï¼šéšæœºç”Ÿæˆ

// MFAå¯†é’¥
- ç®—æ³•ï¼šAES-256-GCM
- å­˜å‚¨ï¼šåŠ å¯†åå­˜å…¥æ•°æ®åº“
```

### 7.8 å®¡è®¡ä¸ç›‘æ§

#### 7.8.1 å®¡è®¡æ—¥å¿—
è®°å½•å†…å®¹ï¼š
- æ‰€æœ‰è®¤è¯äº‹ä»¶ï¼ˆç™»å½•ã€ç™»å‡ºã€æ³¨å†Œï¼‰
- æƒé™å˜æ›´ï¼ˆè§’è‰²åˆ†é…ã€æƒé™ä¿®æ”¹ï¼‰
- æ•æ„Ÿæ“ä½œï¼ˆå¯†ç ä¿®æ”¹ã€MFAå˜æ›´ï¼‰
- å¤±è´¥çš„è®¿é—®å°è¯•
- ç®¡ç†å‘˜æ“ä½œ

æ—¥å¿—å­—æ®µï¼š
- ç”¨æˆ·ID
- æ“ä½œç±»å‹
- èµ„æºç±»å‹å’ŒID
- IPåœ°å€
- UserAgent
- æ—¶é—´æˆ³
- æ“ä½œç»“æœ

#### 7.8.2 å®‰å…¨ç›‘æ§
ç›‘æ§æŒ‡æ ‡ï¼š
- ç™»å½•å¤±è´¥ç‡
- è´¦æˆ·é”å®šæ¬¡æ•°
- å¼‚å¸¸ç™»å½•ï¼ˆæ–°è®¾å¤‡/æ–°åœ°ç‚¹ï¼‰
- APIé”™è¯¯ç‡
- å“åº”æ—¶é—´
- å¹¶å‘è¿æ¥æ•°

å‘Šè­¦è§„åˆ™ï¼š
- ç™»å½•å¤±è´¥ç‡ > 10%
- è´¦æˆ·é”å®š > 5æ¬¡/å°æ—¶
- APIé”™è¯¯ç‡ > 5%
- å“åº”æ—¶é—´ > 1ç§’

### 7.9 åˆè§„æ€§

#### 7.9.1 GDPRåˆè§„
- âœ… ç”¨æˆ·æ•°æ®å¯¼å‡º
- âœ… ç”¨æˆ·æ•°æ®åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
- âœ… æ•°æ®æœ€å°åŒ–åŸåˆ™
- âœ… æ˜ç¡®çš„éšç§æ”¿ç­–
- âœ… ç”¨æˆ·åŒæ„æœºåˆ¶

#### 7.9.2 OWASP Top 10é˜²æŠ¤
| é£é™© | é˜²æŠ¤æªæ–½ |
|------|---------|
| A01:æƒé™æ§åˆ¶å¤±æ•ˆ | RBAC/ABACæƒé™ç³»ç»Ÿ |
| A02:åŠ å¯†æœºåˆ¶å¤±æ•ˆ | TLSã€bcryptã€AES-256 |
| A03:æ³¨å…¥ | å‚æ•°åŒ–æŸ¥è¯¢ã€è¾“å…¥éªŒè¯ |
| A04:ä¸å®‰å…¨è®¾è®¡ | å®‰å…¨è®¾è®¡åŸåˆ™ã€å¨èƒå»ºæ¨¡ |
| A05:å®‰å…¨é…ç½®é”™è¯¯ | é…ç½®éªŒè¯ã€å®‰å…¨é»˜è®¤å€¼ |
| A06:æ˜“å—æ”»å‡»ç»„ä»¶ | ä¾èµ–æ›´æ–°ã€æ¼æ´æ‰«æ |
| A07:èº«ä»½è¯†åˆ«å¤±è´¥ | MFAã€è´¦æˆ·é”å®šã€ä¼šè¯ç®¡ç† |
| A08:è½¯ä»¶å®Œæ•´æ€§å¤±è´¥ | ä»£ç ç­¾åã€ä¾èµ–æ ¡éªŒ |
| A09:æ—¥å¿—ç›‘æ§å¤±è´¥ | å®Œæ•´å®¡è®¡æ—¥å¿—ã€å®æ—¶ç›‘æ§ |
| A10:æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€  | URLç™½åå•ã€è¯·æ±‚éªŒè¯ |

---

## 8. æƒé™ç®¡ç†ç³»ç»Ÿ

### 8.1 æƒé™æ¨¡å‹

#### 8.1.1 RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰

**æ¨¡å‹ç»“æ„ï¼š**
```
ç”¨æˆ·ï¼ˆUserï¼‰ â†â†’ è§’è‰²ï¼ˆRoleï¼‰ â†â†’ æƒé™ï¼ˆPermissionï¼‰
     N              M              N              M
```

**ç¤ºä¾‹ï¼š**
```
ç”¨æˆ·ï¼šå¼ ä¸‰
  â””â”€ è§’è‰²ï¼šç¼–è¾‘è€…
       â”œâ”€ æƒé™ï¼šæ–‡ç« :è¯»å–
       â”œâ”€ æƒé™ï¼šæ–‡ç« :åˆ›å»º
       â””â”€ æƒé™ï¼šæ–‡ç« :ç¼–è¾‘

ç”¨æˆ·ï¼šæå››
  â””â”€ è§’è‰²ï¼šç®¡ç†å‘˜
       â”œâ”€ æƒé™ï¼šç”¨æˆ·:è¯»å–
       â”œâ”€ æƒé™ï¼šç”¨æˆ·:åˆ›å»º
       â”œâ”€ æƒé™ï¼šç”¨æˆ·:ç¼–è¾‘
       â”œâ”€ æƒé™ï¼šç”¨æˆ·:åˆ é™¤
       â””â”€ æƒé™ï¼šè§’è‰²:ç®¡ç†
```

**Casbin RBACæ¨¡å‹é…ç½®ï¼š**
```ini
[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[role_definition]
g = _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = g(r.sub, p.sub) && r.obj == p.obj && r.act == p.act
```

#### 8.1.2 ABACï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰

**å±æ€§ç±»å‹ï¼š**
1. **ç”¨æˆ·å±æ€§ï¼š** éƒ¨é—¨ã€èŒä½ã€çº§åˆ«
2. **èµ„æºå±æ€§ï¼š** æ‰€æœ‰è€…ã€ç±»å‹ã€æ•æ„Ÿçº§åˆ«
3. **ç¯å¢ƒå±æ€§ï¼š** æ—¶é—´ã€IPåœ°å€ã€è®¾å¤‡ç±»å‹

**ç¤ºä¾‹ç­–ç•¥ï¼š**
```
ç­–ç•¥1ï¼šéƒ¨é—¨ç»ç†å¯ä»¥æŸ¥çœ‹æœ¬éƒ¨é—¨å‘˜å·¥çš„ä¿¡æ¯
  IF user.role == "manager" 
  AND resource.department == user.department
  THEN ALLOW

ç­–ç•¥2ï¼šåªèƒ½åœ¨å·¥ä½œæ—¶é—´è®¿é—®æ•æ„Ÿèµ„æº
  IF resource.sensitivity == "high"
  AND time.hour >= 9 AND time.hour <= 18
  THEN ALLOW

ç­–ç•¥3ï¼šèµ„æºæ‰€æœ‰è€…æ‹¥æœ‰å®Œå…¨æƒé™
  IF resource.owner_id == user.id
  THEN ALLOW
```

**Casbin ABACæ¨¡å‹é…ç½®ï¼š**
```ini
[request_definition]
r = sub, obj, act

[policy_definition]
p = sub_rule, obj, act

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = eval(p.sub_rule) && r.obj == p.obj && r.act == p.act
```

### 8.2 é¢„è®¾è§’è‰²å’Œæƒé™

#### 8.2.1 ç³»ç»Ÿè§’è‰²

| è§’è‰²å | æ˜¾ç¤ºåç§° | æè¿° | æƒé™èŒƒå›´ |
|--------|---------|------|---------|
| **admin** | ç³»ç»Ÿç®¡ç†å‘˜ | æœ€é«˜æƒé™ | æ‰€æœ‰æƒé™ |
| **user** | æ™®é€šç”¨æˆ· | åŸºç¡€æƒé™ | ä¸ªäººèµ„æ–™ç®¡ç† |
| **auditor** | å®¡è®¡å‘˜ | åªè¯»æƒé™ | æŸ¥çœ‹å®¡è®¡æ—¥å¿— |
| **developer** | å¼€å‘è€… | OAuth2æƒé™ | åˆ›å»ºOAuth2å®¢æˆ·ç«¯ |

#### 8.2.2 æƒé™åˆ—è¡¨

| æƒé™åç§° | èµ„æº | æ“ä½œ | æè¿° |
|---------|------|------|------|
| user:read | user | read | æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ |
| user:write | user | write | åˆ›å»º/ç¼–è¾‘ç”¨æˆ· |
| user:delete | user | delete | åˆ é™¤ç”¨æˆ· |
| role:read | role | read | æŸ¥çœ‹è§’è‰² |
| role:write | role | write | åˆ›å»º/ç¼–è¾‘è§’è‰² |
| role:delete | role | delete | åˆ é™¤è§’è‰² |
| permission:read | permission | read | æŸ¥çœ‹æƒé™ |
| permission:write | permission | write | åˆ›å»º/ç¼–è¾‘æƒé™ |
| audit:read | audit | read | æŸ¥çœ‹å®¡è®¡æ—¥å¿— |
| oauth2:manage | oauth2 | manage | ç®¡ç†OAuth2å®¢æˆ·ç«¯ |

#### 8.2.3 é»˜è®¤æƒé™åˆ†é…

```
adminè§’è‰²ï¼š
  â”œâ”€ user:read
  â”œâ”€ user:write
  â”œâ”€ user:delete
  â”œâ”€ role:read
  â”œâ”€ role:write
  â”œâ”€ role:delete
  â”œâ”€ permission:read
  â”œâ”€ permission:write
  â”œâ”€ audit:read
  â””â”€ oauth2:manage

userè§’è‰²ï¼š
  â””â”€ ï¼ˆæ— ç³»ç»Ÿæƒé™ï¼Œä»…ä¸ªäººèµ„æ–™ç®¡ç†ï¼‰

auditorè§’è‰²ï¼š
  â”œâ”€ user:read
  â”œâ”€ role:read
  â”œâ”€ permission:read
  â””â”€ audit:read

developerè§’è‰²ï¼š
  â””â”€ oauth2:manage
```

### 8.3 æƒé™æ£€æŸ¥æµç¨‹

```
APIè¯·æ±‚ â†’ è®¤è¯ä¸­é—´ä»¶ â†’ æƒé™ä¸­é—´ä»¶ â†’ ä¸šåŠ¡é€»è¾‘
                          â†“
                    æå–ç”¨æˆ·ID
                          â†“
                    æå–èµ„æºå’Œæ“ä½œ
                          â†“
                    æŸ¥è¯¢ç”¨æˆ·è§’è‰²
                          â†“
                    Casbinæƒé™æ£€æŸ¥
                          â†“
                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                    â†“           â†“
                  å…è®¸        æ‹’ç»
                    â†“           â†“
                ç»§ç»­æ‰§è¡Œ    è¿”å›403
```

**ä»£ç ç¤ºä¾‹ï¼š**
```go
// æƒé™ä¸­é—´ä»¶
func PermissionMiddleware(resource, action string) gin.HandlerFunc {
    return func(c *gin.Context) {
        userID := c.GetUint("user_id")
        
        permissionService, _ := services.NewPermissionService()
        allowed, err := permissionService.CheckPermission(userID, resource, action)
        
        if err != nil || !allowed {
            c.JSON(403, gin.H{"error": "æ— æƒé™è®¿é—®"})
            c.Abort()
            return
        }
        
        c.Next()
    }
}

// ä½¿ç”¨ç¤ºä¾‹
router.GET("/api/admin/users", 
    middleware.AuthMiddleware(),
    middleware.PermissionMiddleware("user", "read"),
    userController.GetAllUsers,
)
```

### 8.4 åŠ¨æ€æƒé™ç®¡ç†

#### 8.4.1 åˆ›å»ºè§’è‰²
```go
// API: POST /api/permission/role
{
  "name": "content_editor",
  "display_name": "å†…å®¹ç¼–è¾‘",
  "description": "è´Ÿè´£å†…å®¹çš„åˆ›å»ºå’Œç¼–è¾‘"
}
```

#### 8.4.2 ä¸ºè§’è‰²åˆ†é…æƒé™
```go
// API: POST /api/permission/role/:role/permission
{
  "resource": "article",
  "action": "write"
}

// Casbinç­–ç•¥
p, content_editor, article, write
```

#### 8.4.3 ä¸ºç”¨æˆ·åˆ†é…è§’è‰²
```go
// API: POST /api/permission/assign-role
{
  "user_id": 123,
  "role_name": "content_editor"
}

// Casbinç­–ç•¥
g, user_123, content_editor
```

### 8.5 æƒé™ç»§æ‰¿

**è§’è‰²ç»§æ‰¿ç¤ºä¾‹ï¼š**
```
è¶…çº§ç®¡ç†å‘˜
  â””â”€ ç»§æ‰¿ â†’ ç®¡ç†å‘˜
              â””â”€ ç»§æ‰¿ â†’ ç¼–è¾‘è€…
                          â””â”€ ç»§æ‰¿ â†’ æ™®é€šç”¨æˆ·
```

**Casbiné…ç½®ï¼š**
```
g, super_admin, admin
g, admin, editor
g, editor, user
```

### 8.6 èµ„æºçº§æƒé™æ§åˆ¶

**åœºæ™¯ï¼š** ç”¨æˆ·åªèƒ½ç¼–è¾‘è‡ªå·±åˆ›å»ºçš„æ–‡ç« 

**å®ç°æ–¹å¼ï¼š**
```go
// æ£€æŸ¥èµ„æºæ‰€æœ‰æƒ
func CheckResourceOwnership(userID uint, resourceID string) bool {
    var article Article
    db.First(&article, resourceID)
    return article.AuthorID == userID
}

// åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨
func UpdateArticle(c *gin.Context) {
    userID := c.GetUint("user_id")
    articleID := c.Param("id")
    
    // æ£€æŸ¥åŸºç¡€æƒé™
    if !hasPermission(userID, "article", "write") {
        c.JSON(403, gin.H{"error": "æ— æƒé™"})
        return
    }
    
    // æ£€æŸ¥èµ„æºæ‰€æœ‰æƒ
    if !CheckResourceOwnership(userID, articleID) {
        c.JSON(403, gin.H{"error": "åªèƒ½ç¼–è¾‘è‡ªå·±çš„æ–‡ç« "})
        return
    }
    
    // æ‰§è¡Œæ›´æ–°
    // ...
}
```

### 8.7 æƒé™ç¼“å­˜ç­–ç•¥

**ç¼“å­˜å†…å®¹ï¼š**
- ç”¨æˆ·è§’è‰²åˆ—è¡¨
- è§’è‰²æƒé™åˆ—è¡¨
- æƒé™æ£€æŸ¥ç»“æœ

**ç¼“å­˜ç­–ç•¥ï¼š**
```go
// Redisç¼“å­˜é”®
user_roles:{user_id}           // ç”¨æˆ·è§’è‰²ï¼ŒTTL: 1å°æ—¶
role_permissions:{role_name}   // è§’è‰²æƒé™ï¼ŒTTL: 1å°æ—¶
permission_check:{user_id}:{resource}:{action}  // æƒé™æ£€æŸ¥ç»“æœï¼ŒTTL: 5åˆ†é’Ÿ

// ç¼“å­˜å¤±æ•ˆ
- è§’è‰²åˆ†é…å˜æ›´ â†’ æ¸…é™¤ç”¨æˆ·è§’è‰²ç¼“å­˜
- æƒé™åˆ†é…å˜æ›´ â†’ æ¸…é™¤è§’è‰²æƒé™ç¼“å­˜
- ç”¨æˆ·ç™»å‡º â†’ æ¸…é™¤æ‰€æœ‰ç›¸å…³ç¼“å­˜
```

---

## 9. å‰ç«¯æ¶æ„è®¾è®¡

### 9.1 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨æ¶æ„                          â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              è·¯ç”±å±‚ï¼ˆReact Routerï¼‰             â”‚    â”‚
â”‚  â”‚  - è·¯ç”±é…ç½®  - è·¯ç”±å®ˆå«  - æ‡’åŠ è½½              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              é¡µé¢å±‚ï¼ˆPagesï¼‰                    â”‚    â”‚
â”‚  â”‚  - ç™»å½•é¡µ  - æ³¨å†Œé¡µ  - ä»ªè¡¨æ¿  - ç®¡ç†åå°     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              å¸ƒå±€å±‚ï¼ˆLayoutsï¼‰                  â”‚    â”‚
â”‚  â”‚  - ç”¨æˆ·å¸ƒå±€  - ç®¡ç†å‘˜å¸ƒå±€  - ç©ºç™½å¸ƒå±€         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              ç»„ä»¶å±‚ï¼ˆComponentsï¼‰               â”‚    â”‚
â”‚  â”‚  - Button  - Input  - Card  - Loading         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              çŠ¶æ€å±‚ï¼ˆZustandï¼‰                  â”‚    â”‚
â”‚  â”‚  - authStore  - userStore  - notificationStore â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              APIå±‚ï¼ˆAxiosï¼‰                     â”‚    â”‚
â”‚  â”‚  - è¯·æ±‚æ‹¦æˆª  - å“åº”æ‹¦æˆª  - é”™è¯¯å¤„ç†           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ç›®å½•ç»“æ„

```
frontend/src/
â”œâ”€â”€ components/          # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ Button.tsx      # æŒ‰é’®ç»„ä»¶
â”‚   â”œâ”€â”€ Input.tsx       # è¾“å…¥æ¡†ç»„ä»¶
â”‚   â”œâ”€â”€ Card.tsx        # å¡ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ Loading.tsx     # åŠ è½½ç»„ä»¶
â”‚   â””â”€â”€ ErrorBoundary.tsx  # é”™è¯¯è¾¹ç•Œ
â”‚
â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Login.tsx       # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ Register.tsx    # æ³¨å†Œé¡µ
â”‚   â”œâ”€â”€ Dashboard.tsx   # ç”¨æˆ·ä»ªè¡¨æ¿
â”‚   â”œâ”€â”€ Profile.tsx     # ä¸ªäººèµ„æ–™
â”‚   â”œâ”€â”€ MFASettings.tsx # MFAè®¾ç½®
â”‚   â”œâ”€â”€ Sessions.tsx    # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ Notifications.tsx  # é€šçŸ¥ä¸­å¿ƒ
â”‚   â””â”€â”€ admin/          # ç®¡ç†åå°é¡µé¢
â”‚       â”œâ”€â”€ AdminDashboard.tsx
â”‚       â”œâ”€â”€ UserManagement.tsx
â”‚       â”œâ”€â”€ RoleManagement.tsx
â”‚       â””â”€â”€ PermissionManagement.tsx
â”‚
â”œâ”€â”€ layouts/            # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ AdminLayout.tsx # ç®¡ç†å‘˜å¸ƒå±€
â”‚
â”œâ”€â”€ stores/             # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ authStore.ts    # è®¤è¯çŠ¶æ€
â”‚
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ api.ts          # APIå®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ App.tsx             # æ ¹ç»„ä»¶
â”œâ”€â”€ main.tsx            # å…¥å£æ–‡ä»¶
â””â”€â”€ index.css           # å…¨å±€æ ·å¼
```

### 9.3 æ ¸å¿ƒé¡µé¢è®¾è®¡

#### 9.3.1 ç™»å½•é¡µé¢ï¼ˆLogin.tsxï¼‰

**åŠŸèƒ½ï¼š**
- ç”¨æˆ·å/é‚®ç®±ç™»å½•
- å¯†ç è¾“å…¥
- è®°ä½æˆ‘é€‰é¡¹
- å¿˜è®°å¯†ç é“¾æ¥
- ç¤¾äº¤ç™»å½•æŒ‰é’®ï¼ˆGitHubï¼‰
- WebAuthnæ— å¯†ç ç™»å½•

**UIå…ƒç´ ï¼š**
```tsx
<LoginPage>
  <Logo />
  <LoginForm>
    <Input placeholder="ç”¨æˆ·åæˆ–é‚®ç®±" />
    <Input type="password" placeholder="å¯†ç " />
    <Checkbox label="è®°ä½æˆ‘" />
    <Button>ç™»å½•</Button>
    <Link to="/forgot-password">å¿˜è®°å¯†ç ï¼Ÿ</Link>
  </LoginForm>
  <Divider text="æˆ–" />
  <SocialLogin>
    <Button icon="github">ä½¿ç”¨GitHubç™»å½•</Button>
  </SocialLogin>
  <WebAuthnLogin>
    <Button icon="fingerprint">ä½¿ç”¨å®‰å…¨å¯†é’¥ç™»å½•</Button>
  </WebAuthnLogin>
  <Footer>
    <Link to="/register">è¿˜æ²¡æœ‰è´¦å·ï¼Ÿç«‹å³æ³¨å†Œ</Link>
  </Footer>
</LoginPage>
```

#### 9.3.2 ç”¨æˆ·ä»ªè¡¨æ¿ï¼ˆDashboard.tsxï¼‰

**åŠŸèƒ½æ¨¡å—ï¼š**
- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡
- å¿«æ·æ“ä½œ
- æœ€è¿‘æ´»åŠ¨
- å®‰å…¨çŠ¶æ€
- é€šçŸ¥æé†’

**å¸ƒå±€ï¼š**
```tsx
<Dashboard>
  <Header>
    <UserAvatar />
    <Greeting>æ¬¢è¿å›æ¥ï¼Œ{username}</Greeting>
  </Header>
  
  <Grid>
    <Card title="ä¸ªäººä¿¡æ¯">
      <UserInfo />
      <Button>ç¼–è¾‘èµ„æ–™</Button>
    </Card>
    
    <Card title="å®‰å…¨çŠ¶æ€">
      <SecurityStatus>
        <Item icon="shield" status="good">
          MFAå·²å¯ç”¨
        </Item>
        <Item icon="key" status="warning">
          å¯†ç 90å¤©æœªæ›´æ”¹
        </Item>
      </SecurityStatus>
    </Card>
    
    <Card title="æ´»è·ƒä¼šè¯">
      <SessionList />
    </Card>
    
    <Card title="æœ€è¿‘æ´»åŠ¨">
      <ActivityList />
    </Card>
  </Grid>
</Dashboard>
```

#### 9.3.3 ç®¡ç†åå°ï¼ˆAdminï¼‰

**å¯¼èˆªèœå•ï¼š**
- ä»ªè¡¨æ¿
- ç”¨æˆ·ç®¡ç†
- è§’è‰²ç®¡ç†
- æƒé™ç®¡ç†
- OAuth2å®¢æˆ·ç«¯
- å®¡è®¡æ—¥å¿—
- ç³»ç»Ÿè®¾ç½®

**ç”¨æˆ·ç®¡ç†é¡µé¢ï¼š**
```tsx
<UserManagement>
  <Toolbar>
    <SearchBox placeholder="æœç´¢ç”¨æˆ·" />
    <Button icon="add">æ·»åŠ ç”¨æˆ·</Button>
  </Toolbar>
  
  <Table>
    <Column field="username" label="ç”¨æˆ·å" />
    <Column field="email" label="é‚®ç®±" />
    <Column field="roles" label="è§’è‰²" />
    <Column field="status" label="çŠ¶æ€" />
    <Column field="created_at" label="åˆ›å»ºæ—¶é—´" />
    <Column field="actions" label="æ“ä½œ">
      <Button icon="edit">ç¼–è¾‘</Button>
      <Button icon="delete">åˆ é™¤</Button>
    </Column>
  </Table>
  
  <Pagination />
</UserManagement>
```

### 9.4 çŠ¶æ€ç®¡ç†ï¼ˆZustandï¼‰

#### 9.4.1 è®¤è¯çŠ¶æ€ï¼ˆauthStore.tsï¼‰

```typescript
interface AuthState {
  // çŠ¶æ€
  isAuthenticated: boolean;
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  
  // æ“ä½œ
  login: (username: string, password: string) => Promise<void>;
  logout: () => void;
  refreshAccessToken: () => Promise<void>;
  updateUser: (user: User) => void;
}

const useAuthStore = create<AuthState>((set, get) => ({
  isAuthenticated: false,
  user: null,
  accessToken: localStorage.getItem('access_token'),
  refreshToken: localStorage.getItem('refresh_token'),
  
  login: async (username, password) => {
    const response = await api.post('/auth/login', { username, password });
    const { access_token, refresh_token, user } = response.data.data;
    
    localStorage.setItem('access_token', access_token);
    localStorage.setItem('refresh_token', refresh_token);
    
    set({
      isAuthenticated: true,
      user,
      accessToken: access_token,
      refreshToken: refresh_token,
    });
  },
  
  logout: () => {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
    
    set({
      isAuthenticated: false,
      user: null,
      accessToken: null,
      refreshToken: null,
    });
  },
  
  refreshAccessToken: async () => {
    const { refreshToken } = get();
    const response = await api.post('/auth/refresh', { refresh_token: refreshToken });
    const { access_token, refresh_token } = response.data.data;
    
    localStorage.setItem('access_token', access_token);
    localStorage.setItem('refresh_token', refresh_token);
    
    set({
      accessToken: access_token,
      refreshToken: refresh_token,
    });
  },
  
  updateUser: (user) => set({ user }),
}));
```

### 9.5 APIå®¢æˆ·ç«¯ï¼ˆapi.tsï¼‰

```typescript
import axios from 'axios';
import { useAuthStore } from '../stores/authStore';

const api = axios.create({
  baseURL: 'http://localhost:8080/api',
  timeout: 10000,
});

// è¯·æ±‚æ‹¦æˆªå™¨
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// å“åº”æ‹¦æˆªå™¨
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    // Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        await useAuthStore.getState().refreshAccessToken();
        return api(originalRequest);
      } catch (refreshError) {
        useAuthStore.getState().logout();
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    
    return Promise.reject(error);
  }
);

export default api;
```

### 9.6 è·¯ç”±é…ç½®

```typescript
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { useAuthStore } from './stores/authStore';

// ç§æœ‰è·¯ç”±å®ˆå«
function PrivateRoute({ children }) {
  const { isAuthenticated } = useAuthStore();
  return isAuthenticated ? children : <Navigate to="/login" />;
}

// ç®¡ç†å‘˜è·¯ç”±å®ˆå«
function AdminRoute({ children }) {
  const { isAuthenticated, user } = useAuthStore();
  const isAdmin = user?.roles?.some(role => role.name === 'admin');
  
  if (!isAuthenticated) return <Navigate to="/login" />;
  if (!isAdmin) return <Navigate to="/dashboard" />;
  
  return children;
}

function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/* å…¬å¼€è·¯ç”± */}
        <Route path="/login" element={<Login />} />
        <Route path="/register" element={<Register />} />
        <Route path="/forgot-password" element={<ForgotPassword />} />
        
        {/* ç”¨æˆ·è·¯ç”± */}
        <Route path="/dashboard" element={
          <PrivateRoute><Dashboard /></PrivateRoute>
        } />
        <Route path="/profile" element={
          <PrivateRoute><Profile /></PrivateRoute>
        } />
        
        {/* ç®¡ç†å‘˜è·¯ç”± */}
        <Route path="/admin" element={
          <AdminRoute><AdminLayout><AdminDashboard /></AdminLayout></AdminRoute>
        } />
        <Route path="/admin/users" element={
          <AdminRoute><AdminLayout><UserManagement /></AdminLayout></AdminRoute>
        } />
        
        {/* é»˜è®¤è·¯ç”± */}
        <Route path="/" element={<Navigate to="/dashboard" />} />
      </Routes>
    </BrowserRouter>
  );
}
```

### 9.7 UIè®¾è®¡é£æ ¼

#### 9.7.1 äºŒæ¬¡å…ƒå­¦é™¢æ²»æ„ˆç³»é£æ ¼

**é…è‰²æ–¹æ¡ˆï¼š**
```css
:root {
  /* ä¸»è‰²è°ƒ - æ˜Ÿç©¹è“ */
  --primary-color: #AEC6E4;
  --primary-light: #C8D9F0;
  --primary-dark: #8BA8CC;
  
  /* è¾…åŠ©è‰² - è–„è·ç»¿ */
  --secondary-color: #B5EAD7;
  --secondary-light: #D0F4E8;
  --secondary-dark: #9AD9C3;
  
  /* èƒŒæ™¯è‰² - äº‘æœµç™½ */
  --bg-primary: #F7F7F7;
  --bg-secondary: #FFFFFF;
  --bg-tertiary: #FAFAFA;
  
  /* æ–‡å­—é¢œè‰² */
  --text-primary: #333333;
  --text-secondary: #666666;
  --text-tertiary: #999999;
  
  /* çŠ¶æ€é¢œè‰² */
  --success: #B5EAD7;
  --warning: #FFE4B5;
  --error: #FFB6C1;
  --info: #AEC6E4;
}
```

**ç»„ä»¶é£æ ¼ï¼š**
```css
/* å¤§åœ†è§’ */
.card {
  border-radius: 20px;
}

.button {
  border-radius: 15px;
}

.input {
  border-radius: 12px;
}

/* è½»å¾®æŠ•å½± */
.card {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

/* æ¯›ç»ç’ƒæ•ˆæœ */
.modal {
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.9);
}

/* æŸ”å’ŒåŠ¨ç”» */
.button {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
}
```

#### 9.7.2 æ²»æ„ˆç³»æ–‡æ¡ˆ

| åœºæ™¯ | æ–‡æ¡ˆ |
|------|------|
| ç™»å½•æˆåŠŸ | "æ¬¢è¿å›æ¥ï¼ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡å“¦~" |
| æ³¨å†ŒæˆåŠŸ | "æ­å–œä½ ï¼æˆåŠŸè·å¾—æ˜Ÿç©¹é€šè¡Œè¯ï¼Œæ¬¢è¿åŠ å…¥å­¦é™¢ï¼" |
| å¯†ç é”™è¯¯ | "é€šè¡Œè¯ä¿¡æ¯ä¼¼ä¹æœ‰äº›åå·®å‘¢ï¼Œè¯·å†ä»”ç»†ç¡®è®¤ä¸€ä¸‹å“¦" |
| MFAéªŒè¯ | "è¯·è¾“å…¥ä½ çš„é­”æ³•å£ä»¤ï¼ˆéªŒè¯ç ï¼‰" |
| ä¼šè¯è¿‡æœŸ | "ä¼‘æ¯æ—¶é—´åˆ°å•¦ï¼Œä¸ºäº†ä½ çš„å®‰å…¨ï¼Œè¯·é‡æ–°éªŒè¯é€šè¡Œè¯" |
| æ“ä½œæˆåŠŸ | "å¤ªæ£’äº†ï¼æ“ä½œæˆåŠŸå®Œæˆ~" |

---

## 10. éƒ¨ç½²ä¸è¿ç»´

### 10.1 éƒ¨ç½²æ¶æ„

#### 10.1.1 Dockerå®¹å™¨åŒ–éƒ¨ç½²

**Docker Composeé…ç½®ï¼š**
```yaml
version: '3.8'

services:
  # åç«¯æœåŠ¡
  backend:
    build: ./backend
    container_name: astro-pass-backend
    ports:
      - "8080:8080"
    environment:
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_USER=astro_pass
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=astro_pass
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - mysql
      - redis
    restart: unless-stopped
    networks:
      - astro-pass-network

  # å‰ç«¯æœåŠ¡
  frontend:
    build: ./frontend
    container_name: astro-pass-frontend
    ports:
      - "3000:80"
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - astro-pass-network

  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: astro-pass-mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=astro_pass
      - MYSQL_USER=astro_pass
      - MYSQL_PASSWORD=${DB_PASSWORD}
    volumes:
      - mysql-data:/var/lib/mysql
    ports:
      - "3306:3306"
    restart: unless-stopped
    networks:
      - astro-pass-network

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: astro-pass-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped
    networks:
      - astro-pass-network

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: astro-pass-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - backend
      - frontend
    restart: unless-stopped
    networks:
      - astro-pass-network

volumes:
  mysql-data:
  redis-data:

networks:
  astro-pass-network:
    driver: bridge
```

#### 10.1.2 ç”Ÿäº§ç¯å¢ƒæ¶æ„

```
                    Internet
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Load Balancer â”‚
              â”‚   (Nginx/HAProxy)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Server 1 â”‚            â”‚  Web Server 2 â”‚
â”‚  (Frontend)   â”‚            â”‚  (Frontend)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                              â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  API Gateway   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App Server 1 â”‚            â”‚  App Server 2 â”‚
â”‚  (Backend)    â”‚            â”‚  (Backend)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                              â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL Master â”‚            â”‚  Redis Clusterâ”‚
â”‚  + Slave      â”‚            â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç¯å¢ƒé…ç½®

#### 10.2.1 å¼€å‘ç¯å¢ƒ

```bash
# åç«¯
cd backend
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶
go run main.go

# å‰ç«¯
cd frontend
pnpm install
pnpm dev
```

#### 10.2.2 ç”Ÿäº§ç¯å¢ƒ

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```bash
# æœåŠ¡å™¨é…ç½®
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
SERVER_MODE=release

# æ•°æ®åº“é…ç½®
DB_HOST=mysql-prod.example.com
DB_PORT=3306
DB_USER=astro_pass
DB_PASSWORD=<strong-password>
DB_NAME=astro_pass_prod

# Redisé…ç½®
REDIS_HOST=redis-prod.example.com
REDIS_PORT=6379
REDIS_PASSWORD=<redis-password>

# JWTé…ç½®ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=<generated-by-openssl-rand-base64-32>
JWT_ACCESS_TOKEN_EXPIRE=15m
JWT_REFRESH_TOKEN_EXPIRE=168h

# åº”ç”¨é…ç½®
APP_URL=https://api.astro-pass.com
FRONTEND_URL=https://astro-pass.com

# SMTPé…ç½®
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=noreply@astro-pass.com
SMTP_PASSWORD=<smtp-password>
SMTP_FROM=æ˜Ÿç©¹é€šè¡Œè¯ <noreply@astro-pass.com>

# WebAuthné…ç½®
WEBAUTHN_RP_ID=astro-pass.com
WEBAUTHN_RP_ORIGIN=https://astro-pass.com
WEBAUTHN_RP_DISPLAY_NAME=æ˜Ÿç©¹é€šè¡Œè¯
```

### 10.3 æ•°æ®åº“ç®¡ç†

#### 10.3.1 åˆå§‹åŒ–è„šæœ¬

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE IF NOT EXISTS astro_pass 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER IF NOT EXISTS 'astro_pass'@'%' 
IDENTIFIED BY 'strong_password';

-- æˆæƒ
GRANT ALL PRIVILEGES ON astro_pass.* 
TO 'astro_pass'@'%';

FLUSH PRIVILEGES;
```

#### 10.3.2 å¤‡ä»½ç­–ç•¥

```bash
# æ¯æ—¥å…¨é‡å¤‡ä»½
0 2 * * * /usr/bin/mysqldump \
  -u astro_pass -p${DB_PASSWORD} \
  astro_pass > /backup/astro_pass_$(date +\%Y\%m\%d).sql

# ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
find /backup -name "astro_pass_*.sql" -mtime +30 -delete

# å¤‡ä»½åˆ°è¿œç¨‹å­˜å‚¨
aws s3 cp /backup/astro_pass_$(date +\%Y\%m\%d).sql \
  s3://astro-pass-backups/
```

#### 10.3.3 æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_created_at ON audit_logs(created_at);

-- åˆ†æè¡¨
ANALYZE TABLE users, roles, permissions, audit_logs;

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE users, roles, permissions, audit_logs;
```

### 10.4 ç›‘æ§ä¸æ—¥å¿—

#### 10.4.1 Prometheusç›‘æ§

**æŒ‡æ ‡æ”¶é›†ï¼š**
```go
// è‡ªå®šä¹‰æŒ‡æ ‡
var (
    httpRequestsTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "http_requests_total",
            Help: "Total number of HTTP requests",
        },
        []string{"method", "endpoint", "status"},
    )
    
    httpRequestDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "http_request_duration_seconds",
            Help: "HTTP request duration in seconds",
        },
        []string{"method", "endpoint"},
    )
    
    loginAttempts = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "login_attempts_total",
            Help: "Total number of login attempts",
        },
        []string{"status"},
    )
)
```

**Grafanaä»ªè¡¨æ¿ï¼š**
- è¯·æ±‚QPS
- å“åº”æ—¶é—´
- é”™è¯¯ç‡
- ç™»å½•æˆåŠŸç‡
- æ´»è·ƒç”¨æˆ·æ•°
- æ•°æ®åº“è¿æ¥æ•°

#### 10.4.2 æ—¥å¿—ç®¡ç†

**æ—¥å¿—çº§åˆ«ï¼š**
```
DEBUG - è°ƒè¯•ä¿¡æ¯
INFO  - ä¸€èˆ¬ä¿¡æ¯
WARN  - è­¦å‘Šä¿¡æ¯
ERROR - é”™è¯¯ä¿¡æ¯
FATAL - è‡´å‘½é”™è¯¯
```

**æ—¥å¿—æ ¼å¼ï¼š**
```json
{
  "timestamp": "2025-11-28T10:00:00Z",
  "level": "INFO",
  "message": "ç”¨æˆ·ç™»å½•æˆåŠŸ",
  "user_id": 123,
  "ip": "192.168.1.1",
  "user_agent": "Mozilla/5.0...",
  "request_id": "abc-123-def"
}
```

**æ—¥å¿—èšåˆï¼ˆELK Stackï¼‰ï¼š**
```
åº”ç”¨æ—¥å¿— â†’ Filebeat â†’ Logstash â†’ Elasticsearch â†’ Kibana
```

### 10.5 æ€§èƒ½ä¼˜åŒ–

#### 10.5.1 æ•°æ®åº“ä¼˜åŒ–

- **è¿æ¥æ± é…ç½®ï¼š**
  ```go
  db.SetMaxOpenConns(100)
  db.SetMaxIdleConns(10)
  db.SetConnMaxLifetime(time.Hour)
  ```

- **æŸ¥è¯¢ä¼˜åŒ–ï¼š**
  - ä½¿ç”¨ç´¢å¼•
  - é¿å…N+1æŸ¥è¯¢
  - ä½¿ç”¨GORMçš„Preload
  - åˆ†é¡µæŸ¥è¯¢

- **è¯»å†™åˆ†ç¦»ï¼š**
  ```go
  // ä¸»åº“ï¼ˆå†™ï¼‰
  masterDB := gorm.Open(...)
  
  // ä»åº“ï¼ˆè¯»ï¼‰
  slaveDB := gorm.Open(...)
  
  // ä½¿ç”¨DBResolver
  db.Use(dbresolver.Register(dbresolver.Config{
      Sources:  []gorm.Dialector{masterDB},
      Replicas: []gorm.Dialector{slaveDB},
  }))
  ```

#### 10.5.2 ç¼“å­˜ç­–ç•¥

**Redisç¼“å­˜ï¼š**
```go
// ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
key := fmt.Sprintf("user:%d", userID)
ttl := 1 * time.Hour

// æŸ¥è¯¢ç¼“å­˜
if cached, err := redis.Get(key); err == nil {
    return cached
}

// æŸ¥è¯¢æ•°æ®åº“
user := queryUserFromDB(userID)

// å†™å…¥ç¼“å­˜
redis.Set(key, user, ttl)
```

**ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼š**
- Cache-Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰
- Write-Throughï¼ˆå†™ç©¿ï¼‰
- Write-Behindï¼ˆå†™å›ï¼‰

#### 10.5.3 CDNåŠ é€Ÿ

- é™æ€èµ„æºï¼ˆJSã€CSSã€å›¾ç‰‡ï¼‰ä½¿ç”¨CDN
- å‰ç«¯åº”ç”¨éƒ¨ç½²åˆ°CDN
- é…ç½®ç¼“å­˜ç­–ç•¥

### 10.6 å®‰å…¨åŠ å›º

#### 10.6.1 æœåŠ¡å™¨å®‰å…¨

```bash
# é˜²ç«å¢™é…ç½®
ufw allow 22/tcp    # SSH
ufw allow 80/tcp    # HTTP
ufw allow 443/tcp   # HTTPS
ufw enable

# ç¦ç”¨rootç™»å½•
sed -i 's/PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config

# é…ç½®fail2ban
apt-get install fail2ban
systemctl enable fail2ban
```

#### 10.6.2 SSL/TLSé…ç½®

```nginx
server {
    listen 443 ssl http2;
    server_name astro-pass.com;
    
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # HSTS
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
}
```

### 10.7 ç¾éš¾æ¢å¤

#### 10.7.1 å¤‡ä»½ç­–ç•¥

- **æ•°æ®åº“å¤‡ä»½ï¼š** æ¯æ—¥å…¨é‡ + æ¯å°æ—¶å¢é‡
- **é…ç½®å¤‡ä»½ï¼š** ç‰ˆæœ¬æ§åˆ¶ï¼ˆGitï¼‰
- **æ—¥å¿—å¤‡ä»½ï¼š** ä¿ç•™30å¤©
- **å¼‚åœ°å¤‡ä»½ï¼š** äº‘å­˜å‚¨ï¼ˆS3/OSSï¼‰

#### 10.7.2 æ¢å¤æµç¨‹

```bash
# 1. åœæ­¢æœåŠ¡
docker-compose down

# 2. æ¢å¤æ•°æ®åº“
mysql -u root -p astro_pass < backup.sql

# 3. æ¢å¤é…ç½®
git checkout production

# 4. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 5. éªŒè¯æœåŠ¡
curl http://localhost:8080/health
```

### 10.8 è¿ç»´æ£€æŸ¥æ¸…å•

#### 10.8.1 æ—¥å¸¸æ£€æŸ¥

- [ ] æœåŠ¡å¥åº·çŠ¶æ€
- [ ] ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡
- [ ] å†…å­˜ä½¿ç”¨ç‡
- [ ] CPUä½¿ç”¨ç‡
- [ ] æ•°æ®åº“è¿æ¥æ•°
- [ ] é”™è¯¯æ—¥å¿—
- [ ] å¤‡ä»½çŠ¶æ€

#### 10.8.2 å‘¨æœŸæ€§ä»»åŠ¡

**æ¯å‘¨ï¼š**
- [ ] å®¡æŸ¥å®¡è®¡æ—¥å¿—
- [ ] æ£€æŸ¥å®‰å…¨å‘Šè­¦
- [ ] æ›´æ–°ä¾èµ–åŒ…
- [ ] æ€§èƒ½åˆ†æ

**æ¯æœˆï¼š**
- [ ] æ•°æ®åº“ä¼˜åŒ–
- [ ] æ¸…ç†è¿‡æœŸæ•°æ®
- [ ] å®‰å…¨æ‰«æ
- [ ] ç¾éš¾æ¢å¤æ¼”ç»ƒ

**æ¯å­£åº¦ï¼š**
- [ ] å®¹é‡è§„åˆ’
- [ ] æ¶æ„è¯„å®¡
- [ ] å®‰å…¨å®¡è®¡
- [ ] æ€§èƒ½æµ‹è¯•

---

## 11. æ€»ç»“ä¸å±•æœ›

### 11.1 é¡¹ç›®æ€»ç»“

æ˜Ÿç©¹é€šè¡Œè¯ï¼ˆAstro-Passï¼‰æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç»Ÿä¸€èº«ä»½è®¤è¯ä¸å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

**æŠ€æœ¯ä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨å…¼å®¹OAuth 2.0å’ŒOIDCæ ‡å‡†
- âœ… é«˜æ€§èƒ½Goè¯­è¨€å®ç°
- âœ… ç°ä»£åŒ–Reactå‰ç«¯
- âœ… å®Œå–„çš„å®‰å…¨é˜²æŠ¤ä½“ç³»
- âœ… çµæ´»çš„æƒé™ç®¡ç†ç³»ç»Ÿ

**åŠŸèƒ½ä¼˜åŠ¿ï¼š**
- âœ… å¤šç§è®¤è¯æ–¹å¼ï¼ˆå¯†ç ã€MFAã€WebAuthnã€ç¤¾äº¤ç™»å½•ï¼‰
- âœ… å®Œæ•´çš„ä¼šè¯ç®¡ç†
- âœ… è¯¦ç»†çš„å®¡è®¡æ—¥å¿—
- âœ… å‹å¥½çš„ç”¨æˆ·ç•Œé¢
- âœ… å¼ºå¤§çš„ç®¡ç†åå°

**å®‰å…¨ä¼˜åŠ¿ï¼š**
- âœ… å¤šå±‚å®‰å…¨é˜²æŠ¤
- âœ… è´¦æˆ·é”å®šæœºåˆ¶
- âœ… å¯†ç ç­–ç•¥ç®¡ç†
- âœ… å®‰å…¨å“åº”å¤´
- âœ… å®Œæ•´çš„å®¡è®¡è¿½è¸ª

### 11.2 æœªæ¥è§„åˆ’

#### çŸ­æœŸè®¡åˆ’ï¼ˆ3ä¸ªæœˆï¼‰
- [ ] å®Œå–„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- [ ] æ·»åŠ APIæ–‡æ¡£ï¼ˆSwaggerï¼‰
- [ ] å®ç°æ›´å¤šç¤¾äº¤ç™»å½•ï¼ˆå¾®ä¿¡ã€QQï¼‰
- [ ] ä¼˜åŒ–æ€§èƒ½å’Œå¹¶å‘èƒ½åŠ›
- [ ] æ·»åŠ å¤šè¯­è¨€æ”¯æŒ

#### ä¸­æœŸè®¡åˆ’ï¼ˆ6ä¸ªæœˆï¼‰
- [ ] å®ç°å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼ï¼ˆClient Credentialsï¼‰
- [ ] æ·»åŠ è®¾å¤‡æŒ‡çº¹è¯†åˆ«
- [ ] å®ç°é£é™©è¯„åˆ†ç³»ç»Ÿ
- [ ] æ·»åŠ è¡Œä¸ºåˆ†æ
- [ ] æ”¯æŒSAML 2.0åè®®

#### é•¿æœŸè®¡åˆ’ï¼ˆ12ä¸ªæœˆï¼‰
- [ ] å¾®æœåŠ¡æ¶æ„æ”¹é€ 
- [ ] æ”¯æŒå¤šç§Ÿæˆ·
- [ ] å®ç°è”é‚¦èº«ä»½è®¤è¯
- [ ] AIé©±åŠ¨çš„å®‰å…¨æ£€æµ‹
- [ ] åŒºå—é“¾èº«ä»½éªŒè¯

### 11.3 æŠ€æœ¯å€ºåŠ¡

- éœ€è¦æ·»åŠ å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- éœ€è¦ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
- éœ€è¦å®ç°Redisé›†ç¾¤
- éœ€è¦æ·»åŠ æ›´å¤šçš„ç›‘æ§æŒ‡æ ‡
- éœ€è¦å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶

### 11.4 è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

**è´¡çŒ®æ–¹å¼ï¼š**
1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ä»£ç 
4. åˆ›å»ºPull Request

**ä»£ç è§„èŒƒï¼š**
- Goä»£ç éµå¾ªå®˜æ–¹è§„èŒƒ
- TypeScriptä½¿ç”¨ESLint
- æäº¤ä¿¡æ¯ä½¿ç”¨çº¦å®šå¼æäº¤

---

## é™„å½•

### A. å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

**Q: å¦‚ä½•ä¿®æ”¹JWTå¯†é’¥ï¼Ÿ**
A: ä¿®æ”¹.envæ–‡ä»¶ä¸­çš„JWT_SECRETï¼Œå»ºè®®ä½¿ç”¨`openssl rand -base64 32`ç”Ÿæˆã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°çš„OAuth2å®¢æˆ·ç«¯ï¼Ÿ**
A: ç™»å½•åè®¿é—®OAuth2å®¢æˆ·ç«¯ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»"åˆ›å»ºå®¢æˆ·ç«¯"ã€‚

**Q: å¦‚ä½•å¯ç”¨MFAï¼Ÿ**
A: ç™»å½•åè®¿é—®MFAè®¾ç½®é¡µé¢ï¼Œæ‰«æäºŒç»´ç å¹¶è¾“å…¥éªŒè¯ç ã€‚

**Q: å¦‚ä½•é‡ç½®ç®¡ç†å‘˜å¯†ç ï¼Ÿ**
A: ä½¿ç”¨æ•°æ®åº“ç›´æ¥ä¿®æ”¹æˆ–è¿è¡Œå¯†ç é‡ç½®è„šæœ¬ã€‚

### B. æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| SSO | Single Sign-Onï¼Œå•ç‚¹ç™»å½• |
| OAuth 2.0 | å¼€æ”¾æˆæƒæ ‡å‡† |
| OIDC | OpenID Connectï¼Œèº«ä»½è®¤è¯å±‚ |
| JWT | JSON Web Token |
| TOTP | Time-based One-Time Password |
| WebAuthn | Web Authentication API |
| RBAC | Role-Based Access Control |
| ABAC | Attribute-Based Access Control |
| MFA | Multi-Factor Authentication |

### C. å‚è€ƒèµ„æ–™

- [OAuth 2.0 RFC 6749](https://tools.ietf.org/html/rfc6749)
- [OpenID Connect Core 1.0](https://openid.net/specs/openid-connect-core-1_0.html)
- [JWT RFC 7519](https://tools.ietf.org/html/rfc7519)
- [WebAuthn W3C Recommendation](https://www.w3.org/TR/webauthn/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

---

**æ–‡æ¡£ç»“æŸ**

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­ï¼Œæœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´11æœˆ28æ—¥*
